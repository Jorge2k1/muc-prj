/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var e={7:()=>{$(document).ready((function(){$(".menu a").click((function(e){e.preventDefault();var t=$(this.hash);t.length&&$("html, body").animate({scrollTop:t.offset().top},1e3)}))})),$(document).ready((function(){$(window).scroll((function(){$(this).scrollTop()>100?($(".head").addClass("scrolled"),$(".menu").addClass("scrolled"),$(".global").addClass("scrolled")):($(".head").removeClass("scrolled"),$(".menu").removeClass("scrolled"),$(".global").removeClass("scrolled"))}))})),$(document).ready((function(){$(window).scroll((function(){var e=$(this).scrollTop(),t=$(window).height(),n=100-e/t*62,r=Math.max(0,38-e/t*38);n=Math.max(n,0),r=Math.min(r,38),$(".global").css("background-image","linear-gradient(to bottom, black ".concat(r,"%,  #013220 ").concat(n,"%)")),n<=19?$(".front").addClass("white-text"):$(".front").removeClass("white-text")}))}))}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,n),s.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{"use strict";n(7);const e=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},t={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){const i=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,u=i>>2,h=(3&i)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(l=64)),r.push(n[u],n[h],n[l],n[d])}return r.join("")},encodeString(t,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(t):this.encodeByteArray(e(t),n)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let t=0;t<e.length;){const s=n[e.charAt(t++)],o=t<e.length?n[e.charAt(t)]:0;++t;const a=t<e.length?n[e.charAt(t)]:64;++t;const c=t<e.length?n[e.charAt(t)]:64;if(++t,null==s||null==o||null==a||null==c)throw new r;const u=s<<2|o>>4;if(i.push(u),64!==a){const e=o<<4&240|a>>2;if(i.push(e),64!==c){const e=a<<6&192|c;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class r extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const i=function(n){return function(n){const r=e(n);return t.encodeByteArray(r,!0)}(n).replace(/\./g,"")},s=function(e){try{return t.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},o=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&s(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},a=e=>{var t,n;return null===(n=null===(t=o())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},c=()=>{var e;return null===(e=o())||void 0===e?void 0:e.config},u=e=>{var t;return null===(t=o())||void 0===t?void 0:t[`_${e}`]};class h{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function l(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function d(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function f(){try{return"object"==typeof indexedDB}catch(e){return!1}}function p(){return new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}}))}class g extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,g.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,m.prototype.create)}}class m{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(y,((e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new g(r,o,n)}}const y=/\{\$([^}]+)}/g;function v(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(w(n)&&w(s)){if(!v(n,s))return!1}else if(n!==s)return!1}for(const e of r)if(!n.includes(e))return!1;return!0}function w(e){return null!==e&&"object"==typeof e}function _(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function I(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}})),t}function b(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class E{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=T),void 0===r.error&&(r.error=T),void 0===r.complete&&(r.complete=T);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}})),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function T(){}const S=1e3,C=2,k=144e5,A=.5;function N(e,t=S,n=C){const r=t*Math.pow(n,e),i=Math.round(A*r*(Math.random()-.5)*2);return Math.min(k,r+i)}function D(e){return e&&e._delegate?e._delegate:e}class R{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const O="[DEFAULT]";class P{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new h;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:O})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=O){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=O){return this.instances.has(e)}getOptions(e=O){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===O?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=O){return this.component?this.component.multipleInstances?e:O:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class L{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new P(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const M=[];var x;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(x||(x={}));const U={debug:x.DEBUG,verbose:x.VERBOSE,info:x.INFO,warn:x.WARN,error:x.ERROR,silent:x.SILENT},F=x.INFO,V={[x.DEBUG]:"log",[x.VERBOSE]:"log",[x.INFO]:"info",[x.WARN]:"warn",[x.ERROR]:"error"},j=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),i=V[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};class B{constructor(e){this.name=e,this._logLevel=F,this._logHandler=j,this._userLogHandler=null,M.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in x))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?U[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,x.DEBUG,...e),this._logHandler(this,x.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,x.VERBOSE,...e),this._logHandler(this,x.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,x.INFO,...e),this._logHandler(this,x.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,x.WARN,...e),this._logHandler(this,x.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,x.ERROR,...e),this._logHandler(this,x.ERROR,...e)}}const $=(e,t)=>t.some((t=>e instanceof t));let q,z;const K=new WeakMap,H=new WeakMap,G=new WeakMap,W=new WeakMap,Q=new WeakMap;let J={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return H.get(e);if("objectStoreNames"===t)return e.objectStoreNames||G.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Y(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function X(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(z||(z=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(Z(this),e),Y(K.get(this))}:function(...e){return Y(t.apply(Z(this),e))}:function(e,...n){const r=t.call(Z(this),e,...n);return G.set(r,e.sort?e.sort():[e]),Y(r)}:(e instanceof IDBTransaction&&function(e){if(H.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)}));H.set(e,t)}(e),$(e,q||(q=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,J):e);var t}function Y(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(Y(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&K.set(t,e)})).catch((()=>{})),Q.set(t,e),t}(e);if(W.has(e))return W.get(e);const t=X(e);return t!==e&&(W.set(e,t),Q.set(t,e)),t}const Z=e=>Q.get(e);function ee(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),a=Y(o);return r&&o.addEventListener("upgradeneeded",(e=>{r(Y(o.result),e.oldVersion,e.newVersion,Y(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{s&&e.addEventListener("close",(()=>s())),i&&e.addEventListener("versionchange",(e=>i(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}const te=["get","getKey","getAll","getAllKeys","count"],ne=["put","add","delete","clear"],re=new Map;function ie(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(re.get(t))return re.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=ne.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!te.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&s.done]))[0]};return re.set(t,s),s}var se;se=J,J={...se,get:(e,t,n)=>ie(e,t)||se.get(e,t,n),has:(e,t)=>!!ie(e,t)||se.has(e,t)};class oe{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const ae="@firebase/app",ce="0.9.28",ue=new B("@firebase/app"),he="[DEFAULT]",le={[ae]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},de=new Map,fe=new Map;function pe(e,t){try{e.container.addComponent(t)}catch(n){ue.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function ge(e){const t=e.name;if(fe.has(t))return ue.debug(`There were multiple attempts to register component ${t}.`),!1;fe.set(t,e);for(const t of de.values())pe(t,e);return!0}function me(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}const ye=new m("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class ve{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new R("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ye.create("app-deleted",{appName:this._name})}}const we="10.8.1";function _e(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const r=Object.assign({name:he,automaticDataCollectionEnabled:!1},t),i=r.name;if("string"!=typeof i||!i)throw ye.create("bad-app-name",{appName:String(i)});if(n||(n=c()),!n)throw ye.create("no-options");const s=de.get(i);if(s){if(v(n,s.options)&&v(r,s.config))return s;throw ye.create("duplicate-app",{appName:i})}const o=new L(i);for(const e of fe.values())o.addComponent(e);const a=new ve(n,r,o);return de.set(i,a),a}function Ie(e=he){const t=de.get(e);if(!t&&e===he&&c())return _e();if(!t)throw ye.create("no-app",{appName:e});return t}function be(e,t,n){var r;let i=null!==(r=le[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=[`Unable to register library "${i}" with version "${t}":`];return s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void ue.warn(e.join(" "))}ge(new R(`${i}-version`,(()=>({library:i,version:t})),"VERSION"))}const Ee="firebase-heartbeat-database",Te=1,Se="firebase-heartbeat-store";let Ce=null;function ke(){return Ce||(Ce=ee(Ee,Te,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(Se)}catch(e){console.warn(e)}}}).catch((e=>{throw ye.create("idb-open",{originalErrorMessage:e.message})}))),Ce}async function Ae(e,t){try{const n=(await ke()).transaction(Se,"readwrite"),r=n.objectStore(Se);await r.put(t,Ne(e)),await n.done}catch(e){if(e instanceof g)ue.warn(e.message);else{const t=ye.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});ue.warn(t.message)}}}function Ne(e){return`${e.name}!${e.options.appId}`}class De{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Oe(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){var e,t;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Re();if((null!=(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||(this._heartbeatsCache=await this._heartbeatsCachePromise,null!=(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))&&this._heartbeatsCache.lastSentHeartbeatDate!==r&&!this._heartbeatsCache.heartbeats.some((e=>e.date===r)))return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var e;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=Re(),{heartbeatsToSend:n,unsentEntries:r}=function(e,t=1024){const n=[];let r=e.slice();for(const i of e){const e=n.find((e=>e.agent===i.agent));if(e){if(e.dates.push(i.date),Pe(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),Pe(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),s=i(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}}function Re(){return(new Date).toISOString().substring(0,10)}class Oe{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!f()&&p().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await ke()).transaction(Se),n=await t.objectStore(Se).get(Ne(e));return await t.done,n}catch(e){if(e instanceof g)ue.warn(e.message);else{const t=ye.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});ue.warn(t.message)}}}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Ae(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Ae(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function Pe(e){return i(JSON.stringify({version:2,heartbeats:e})).length}ge(new R("platform-logger",(e=>new oe(e)),"PRIVATE")),ge(new R("heartbeat",(e=>new De(e)),"PRIVATE")),be(ae,ce,""),be(ae,ce,"esm2017"),be("fire-js",""),be("firebase","10.8.1","app");const Le="@firebase/installations",Me="0.6.5",xe=1e4,Ue=`w:${Me}`,Fe="FIS_v2",Ve="https://firebaseinstallations.googleapis.com/v1",je=36e5,Be=new m("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function $e(e){return e instanceof g&&e.code.includes("request-failed")}function qe({projectId:e}){return`${Ve}/projects/${e}/installations`}function ze(e){return{token:e.token,requestStatus:2,expiresIn:(t=e.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()};var t}async function Ke(e,t){const n=(await t.json()).error;return Be.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function He({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}async function Ge(e){const t=await e();return t.status>=500&&t.status<600?e():t}function We(e){return new Promise((t=>{setTimeout(t,e)}))}const Qe=/^[cdef][\w-]{21}$/,Je="";function Xe(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=function(e){var t;return(t=e,btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22)}(e);return Qe.test(t)?t:Je}catch(e){return Je}}function Ye(e){return`${e.appName}!${e.appId}`}const Ze=new Map;function et(e,t){const n=Ye(e);tt(n,t),function(e,t){const n=(!nt&&"BroadcastChannel"in self&&(nt=new BroadcastChannel("[Firebase] FID Change"),nt.onmessage=e=>{tt(e.data.key,e.data.fid)}),nt);n&&n.postMessage({key:e,fid:t}),0===Ze.size&&nt&&(nt.close(),nt=null)}(n,t)}function tt(e,t){const n=Ze.get(e);if(n)for(const e of n)e(t)}let nt=null;const rt="firebase-installations-database",it=1,st="firebase-installations-store";let ot=null;function at(){return ot||(ot=ee(rt,it,{upgrade:(e,t)=>{0===t&&e.createObjectStore(st)}})),ot}async function ct(e,t){const n=Ye(e),r=(await at()).transaction(st,"readwrite"),i=r.objectStore(st),s=await i.get(n);return await i.put(t,n),await r.done,s&&s.fid===t.fid||et(e,t.fid),t}async function ut(e){const t=Ye(e),n=(await at()).transaction(st,"readwrite");await n.objectStore(st).delete(t),await n.done}async function ht(e,t){const n=Ye(e),r=(await at()).transaction(st,"readwrite"),i=r.objectStore(st),s=await i.get(n),o=t(s);return void 0===o?await i.delete(n):await i.put(o,n),await r.done,!o||s&&s.fid===o.fid||et(e,o.fid),o}async function lt(e){let t;const n=await ht(e.appConfig,(n=>{const r=function(e){return pt(e||{fid:Xe(),registrationStatus:0})}(n),i=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(Be.create("app-offline"))};const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},r=async function(e,t){try{const n=await async function({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const r=qe(e),i=He(e),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}const o={fid:n,authVersion:Fe,appId:e.appId,sdkVersion:Ue},a={method:"POST",headers:i,body:JSON.stringify(o)},c=await Ge((()=>fetch(r,a)));if(c.ok){const e=await c.json();return{fid:e.fid||n,registrationStatus:2,refreshToken:e.refreshToken,authToken:ze(e.authToken)}}throw await Ke("Create Installation",c)}(e,t);return ct(e.appConfig,n)}catch(n){throw $e(n)&&409===n.customData.serverCode?await ut(e.appConfig):await ct(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}(e,n);return{installationEntry:n,registrationPromise:r}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:dt(e)}:{installationEntry:t}}(e,r);return t=i.registrationPromise,i.installationEntry}));return n.fid===Je?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}async function dt(e){let t=await ft(e.appConfig);for(;1===t.registrationStatus;)await We(100),t=await ft(e.appConfig);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:n}=await lt(e);return n||t}return t}function ft(e){return ht(e,(e=>{if(!e)throw Be.create("installation-not-found");return pt(e)}))}function pt(e){return 1===(t=e).registrationStatus&&t.registrationTime+xe<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function gt({appConfig:e,heartbeatServiceProvider:t},n){const r=function(e,{fid:t}){return`${qe(e)}/${t}/authTokens:generate`}(e,n),i=function(e,{refreshToken:t}){const n=He(e);return n.append("Authorization",function(e){return`${Fe} ${e}`}(t)),n}(e,n),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}const o={installation:{sdkVersion:Ue,appId:e.appId}},a={method:"POST",headers:i,body:JSON.stringify(o)},c=await Ge((()=>fetch(r,a)));if(c.ok)return ze(await c.json());throw await Ke("Generate Auth Token",c)}async function mt(e,t=!1){let n;const r=await ht(e.appConfig,(r=>{if(!vt(r))throw Be.create("not-registered");const i=r.authToken;if(!t&&(2===(s=i).requestStatus&&!function(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+je}(s)))return r;var s;if(1===i.requestStatus)return n=async function(e,t){let n=await yt(e.appConfig);for(;1===n.authToken.requestStatus;)await We(100),n=await yt(e.appConfig);const r=n.authToken;return 0===r.requestStatus?mt(e,t):r}(e,t),r;{if(!navigator.onLine)throw Be.create("app-offline");const t=function(e){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}(r);return n=async function(e,t){try{const n=await gt(e,t),r=Object.assign(Object.assign({},t),{authToken:n});return await ct(e.appConfig,r),n}catch(n){if(!$e(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await ct(e.appConfig,n)}else await ut(e.appConfig);throw n}}(e,t),t}}));return n?await n:r.authToken}function yt(e){return ht(e,(e=>{if(!vt(e))throw Be.create("not-registered");return 1===(t=e.authToken).requestStatus&&t.requestTime+xe<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e;var t}))}function vt(e){return void 0!==e&&2===e.registrationStatus}function wt(e){return Be.create("missing-app-config-values",{valueName:e})}const _t="installations";ge(new R(_t,(e=>{const t=e.getProvider("app").getImmediate(),n=function(e){if(!e||!e.options)throw wt("App Configuration");if(!e.name)throw wt("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw wt(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t);return{app:t,appConfig:n,heartbeatServiceProvider:me(t,"heartbeat"),_delete:()=>Promise.resolve()}}),"PUBLIC")),ge(new R("installations-internal",(e=>{const t=me(e.getProvider("app").getImmediate(),_t).getImmediate();return{getId:()=>async function(e){const t=e,{installationEntry:n,registrationPromise:r}=await lt(t);return r?r.catch(console.error):mt(t).catch(console.error),n.fid}(t),getToken:e=>async function(e,t=!1){const n=e;return await async function(e){const{registrationPromise:t}=await lt(e);t&&await t}(n),(await mt(n,t)).token}(t,e)}}),"PRIVATE")),be(Le,Me),be(Le,Me,"esm2017");const It="analytics",bt="firebase_id",Et="origin",Tt=6e4,St="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",Ct="https://www.googletagmanager.com/gtag/js",kt=new B("@firebase/analytics"),At=new m("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function Nt(e){if(!e.startsWith(Ct)){const t=At.create("invalid-gtag-resource",{gtagURL:e});return kt.warn(t.message),""}return e}function Dt(e){return Promise.all(e.map((e=>e.catch((e=>e)))))}const Rt=30,Ot=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};function Pt(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}async function Lt(e,t=Ot,n){const{appId:r,apiKey:i,measurementId:s}=e.options;if(!r)throw At.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:r};throw At.create("no-api-key")}const o=t.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new xt;return setTimeout((async()=>{a.abort()}),void 0!==n?n:Tt),Mt({appId:r,apiKey:i,measurementId:s},o,a,t)}async function Mt(e,{throttleEndTimeMillis:t,backoffCount:n},r,i=Ot){var s;const{appId:o,measurementId:a}=e;try{await function(e,t){return new Promise(((n,r)=>{const i=Math.max(t-Date.now(),0),s=setTimeout(n,i);e.addEventListener((()=>{clearTimeout(s),r(At.create("fetch-throttle",{throttleEndTimeMillis:t}))}))}))}(r,t)}catch(e){if(a)return kt.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==e?void 0:e.message}]`),{appId:o,measurementId:a};throw e}try{const t=await async function(e){var t;const{appId:n,apiKey:r}=e,i={method:"GET",headers:Pt(r)},s=St.replace("{app-id}",n),o=await fetch(s,i);if(200!==o.status&&304!==o.status){let e="";try{const n=await o.json();(null===(t=n.error)||void 0===t?void 0:t.message)&&(e=n.error.message)}catch(e){}throw At.create("config-fetch-failed",{httpStatus:o.status,responseMessage:e})}return o.json()}(e);return i.deleteThrottleMetadata(o),t}catch(t){const c=t;if(!function(e){if(!(e instanceof g&&e.customData))return!1;const t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(c)){if(i.deleteThrottleMetadata(o),a)return kt.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==c?void 0:c.message}]`),{appId:o,measurementId:a};throw t}const u=503===Number(null===(s=null==c?void 0:c.customData)||void 0===s?void 0:s.httpStatus)?N(n,i.intervalMillis,Rt):N(n,i.intervalMillis),h={throttleEndTimeMillis:Date.now()+u,backoffCount:n+1};return i.setThrottleMetadata(o,h),kt.debug(`Calling attemptFetch again in ${u} millis`),Mt(e,h,r,i)}}class xt{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach((e=>e()))}}let Ut,Ft;async function Vt(e,t,n,r,i,s,o){var a;const c=Lt(e);c.then((t=>{n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&kt.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((e=>kt.error(e))),t.push(c);const u=async function(){if(!f())return kt.warn(At.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await p()}catch(e){return kt.warn(At.create("indexeddb-unavailable",{errorInfo:null==e?void 0:e.toString()}).message),!1}return!0}().then((e=>e?r.getId():void 0)),[h,l]=await Promise.all([c,u]);(function(e){const t=window.document.getElementsByTagName("script");for(const n of Object.values(t))if(n.src&&n.src.includes(Ct)&&n.src.includes(e))return n;return null})(s)||function(e,t){const n=function(e,t){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy("firebase-js-sdk-policy",t)),n}(0,{createScriptURL:Nt}),r=document.createElement("script"),i=`${Ct}?l=${e}&id=${t}`;r.src=n?null==n?void 0:n.createScriptURL(i):i,r.async=!0,document.head.appendChild(r)}(s,h.measurementId),Ft&&(i("consent","default",Ft),Ft=void 0),i("js",new Date);const d=null!==(a=null==o?void 0:o.config)&&void 0!==a?a:{};return d[Et]="firebase",d.update=!0,null!=l&&(d[bt]=l),i("config",h.measurementId,d),Ut&&(i("set",Ut),Ut=void 0),h.measurementId}class jt{constructor(e){this.app=e}_delete(){return delete Bt[this.app.options.appId],Promise.resolve()}}let Bt={},$t=[];const qt={};let zt,Kt,Ht="dataLayer",Gt=!1;function Wt(e,t,n){!function(){const e=[];if(d()&&e.push("This is a browser extension environment."),"undefined"!=typeof navigator&&navigator.cookieEnabled||e.push("Cookies are not available."),e.length>0){const t=e.map(((e,t)=>`(${t+1}) ${e}`)).join(" "),n=At.create("invalid-analytics-context",{errorInfo:t});kt.warn(n.message)}}();const r=e.options.appId;if(!r)throw At.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw At.create("no-api-key");kt.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=Bt[r])throw At.create("already-exists",{id:r});if(!Gt){!function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t}(Ht);const{wrappedGtag:e,gtagCore:t}=function(e,t,n,r,i){let s=function(...e){window[r].push(arguments)};return window[i]&&"function"==typeof window[i]&&(s=window[i]),window[i]=function(e,t,n,r){return async function(i,...s){try{if("event"===i){const[r,i]=s;await async function(e,t,n,r,i){try{let s=[];if(i&&i.send_to){let e=i.send_to;Array.isArray(e)||(e=[e]);const r=await Dt(n);for(const n of e){const e=r.find((e=>e.measurementId===n)),i=e&&t[e.appId];if(!i){s=[];break}s.push(i)}}0===s.length&&(s=Object.values(t)),await Promise.all(s),e("event",r,i||{})}catch(e){kt.error(e)}}(e,t,n,r,i)}else if("config"===i){const[i,o]=s;await async function(e,t,n,r,i,s){const o=r[i];try{if(o)await t[o];else{const e=(await Dt(n)).find((e=>e.measurementId===i));e&&await t[e.appId]}}catch(e){kt.error(e)}e("config",i,s)}(e,t,n,r,i,o)}else if("consent"===i){const[t]=s;e("consent","update",t)}else if("get"===i){const[t,n,r]=s;e("get",t,n,r)}else if("set"===i){const[t]=s;e("set",t)}else e(i,...s)}catch(e){kt.error(e)}}}(s,e,t,n),{gtagCore:s,wrappedGtag:window[i]}}(Bt,$t,qt,Ht,"gtag");Kt=e,zt=t,Gt=!0}return Bt[r]=Vt(e,$t,qt,t,zt,Ht,n),new jt(e)}const Qt="@firebase/analytics",Jt="0.10.1";function Xt(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}ge(new R(It,((e,{options:t})=>Wt(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t)),"PUBLIC")),ge(new R("analytics-internal",(function(e){try{const t=e.getProvider(It).getImmediate();return{logEvent:(e,n,r)=>function(e,t,n,r){e=D(e),async function(e,t,n,r,i){if(i&&i.global)e("event",n,r);else{const i=await t;e("event",n,Object.assign(Object.assign({},r),{send_to:i}))}}(Kt,Bt[e.app.options.appId],t,n,r).catch((e=>kt.error(e)))}(t,e,n,r)}}catch(e){throw At.create("interop-component-reg-failed",{reason:e})}}),"PRIVATE")),be(Qt,Jt),be(Qt,Jt,"esm2017"),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;const Yt=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},Zt=new m("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),en=new B("@firebase/auth");function tn(e,...t){en.logLevel<=x.ERROR&&en.error(`Auth (${we}): ${e}`,...t)}function nn(e,...t){throw sn(e,...t)}function rn(e,...t){return sn(e,...t)}function sn(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return Zt.create(e,...t)}function on(e,t,...n){if(!e)throw sn(t,...n)}function an(e){const t="INTERNAL ASSERTION FAILED: "+e;throw tn(t),new Error(t)}function cn(e,t){e||an(t)}function un(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function hn(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class ln{constructor(e,t){this.shortDelay=e,this.longDelay=t,cn(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(l())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===hn()||"https:"===hn()||d()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function dn(e,t){cn(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class fn{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void an("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void an("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void an("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const pn={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},gn=new ln(3e4,6e4);function mn(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function yn(e,t,n,r,i={}){return vn(e,i,(async()=>{let i={},s={};r&&("GET"===t?s=r:i={body:JSON.stringify(r)});const o=_(Object.assign({key:e.config.apiKey},s)).slice(1),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode),fn.fetch()(_n(e,e.config.apiHost,n,o),Object.assign({method:t,headers:a,referrerPolicy:"no-referrer"},i))}))}async function vn(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},pn),t);try{const t=new bn(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await i.json();if("needConfirmation"in s)throw En(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw En(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw En(e,"email-already-in-use",s);if("USER_DISABLED"===n)throw En(e,"user-disabled",s);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw function(e,t,n){const r=Object.assign(Object.assign({},Yt()),{[t]:n});return new m("auth","Firebase",r).create(t,{appName:e.name})}(e,a,o);nn(e,a)}}catch(t){if(t instanceof g)throw t;nn(e,"network-request-failed",{message:String(t)})}}async function wn(e,t,n,r,i={}){const s=await yn(e,t,n,r,i);return"mfaPendingCredential"in s&&nn(e,"multi-factor-auth-required",{_serverResponse:s}),s}function _n(e,t,n,r){const i=`${t}${n}?${r}`;return e.config.emulator?dn(e.config,i):`${e.config.apiScheme}://${i}`}function In(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class bn{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(rn(this.auth,"network-request-failed"))),gn.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function En(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=rn(e,t,r);return i.customData._tokenResponse=n,i}function Tn(e){return void 0!==e&&void 0!==e.enterprise}class Sn{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return In(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}}function Cn(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function kn(e){return 1e3*Number(e)}function An(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return tn("JWT malformed, contained fewer than 3 sections"),null;try{const e=s(n);return e?JSON.parse(e):(tn("Failed to decode base64 JWT payload"),null)}catch(e){return tn("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}async function Nn(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof g&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class Dn{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class Rn{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Cn(this.lastLoginAt),this.creationTime=Cn(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function On(e){var t;const n=e.auth,r=await e.getIdToken(),i=await Nn(e,async function(e,t){return yn(e,"POST","/v1/accounts:lookup",t)}(n,{idToken:r}));on(null==i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?s.providerUserInfo.map((e=>{var{providerId:t}=e,n=Xt(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[],a=(c=e.providerData,u=o,[...c.filter((e=>!u.some((t=>t.providerId===e.providerId)))),...u]);var c,u;const h=e.isAnonymous,l=!(e.email&&s.passwordHash||(null==a?void 0:a.length)),d=!!h&&l,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new Rn(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(e,f)}class Pn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){on(e.idToken,"internal-error"),on(void 0!==e.idToken,"internal-error"),on(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){const t=An(e);return on(t,"internal-error"),on(void 0!==t.exp,"internal-error"),on(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return on(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:i}=await async function(e,t){const n=await vn(e,{},(async()=>{const n=_({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,s=_n(e,r,"/v1/token",`key=${i}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",fn.fetch()(s,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new Pn;return n&&(on("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(on("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(on("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Pn,this.toJSON())}_performRefresh(){return an("not implemented")}}function Ln(e,t){on("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Mn{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=Xt(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Dn(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Rn(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await Nn(this,this.stsTokenManager.getToken(this.auth,e));return on(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=D(e),r=await n.getIdToken(t),i=An(r);on(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s="object"==typeof i.firebase?i.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:Cn(kn(i.auth_time)),issuedAtTime:Cn(kn(i.iat)),expirationTime:Cn(kn(i.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=D(e);await On(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(on(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Mn(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){on(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await On(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await Nn(this,async function(e,t){return yn(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,o,a,c,u;const h=null!==(n=t.displayName)&&void 0!==n?n:void 0,l=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,f=null!==(s=t.photoURL)&&void 0!==s?s:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,g=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,m=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:v,emailVerified:w,isAnonymous:_,providerData:I,stsTokenManager:b}=t;on(v&&b,e,"internal-error");const E=Pn.fromJSON(this.name,b);on("string"==typeof v,e,"internal-error"),Ln(h,e.name),Ln(l,e.name),on("boolean"==typeof w,e,"internal-error"),on("boolean"==typeof _,e,"internal-error"),Ln(d,e.name),Ln(f,e.name),Ln(p,e.name),Ln(g,e.name),Ln(m,e.name),Ln(y,e.name);const T=new Mn({uid:v,auth:e,email:l,emailVerified:w,displayName:h,isAnonymous:_,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:E,createdAt:m,lastLoginAt:y});return I&&Array.isArray(I)&&(T.providerData=I.map((e=>Object.assign({},e)))),g&&(T._redirectEventId=g),T}static async _fromIdTokenResponse(e,t,n=!1){const r=new Pn;r.updateFromServerResponse(t);const i=new Mn({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await On(i),i}}const xn=new Map;function Un(e){cn(e instanceof Function,"Expected a class definition");let t=xn.get(e);return t?(cn(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,xn.set(e,t),t)}class Fn{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Fn.type="NONE";const Vn=Fn;function jn(e,t,n){return`firebase:${e}:${t}:${n}`}class Bn{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=jn(this.userKey,r.apiKey,i),this.fullPersistenceKey=jn("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Mn._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new Bn(Un(Vn),e,n);const r=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let i=r[0]||Un(Vn);const s=jn(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=await n._get(s);if(t){const r=Mn._fromJSON(e,t);n!==i&&(o=r),i=n;break}}catch(e){}const a=r.filter((e=>e._shouldAllowMigration));return i._shouldAllowMigration&&a.length?(i=a[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new Bn(i,e,n)):new Bn(i,e,n)}}function $n(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Hn(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(qn(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Wn(t))return"Blackberry";if(Qn(t))return"Webos";if(zn(t))return"Safari";if((t.includes("chrome/")||Kn(t))&&!t.includes("edge/"))return"Chrome";if(Gn(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function qn(e=l()){return/firefox\//i.test(e)}function zn(e=l()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Kn(e=l()){return/crios\//i.test(e)}function Hn(e=l()){return/iemobile/i.test(e)}function Gn(e=l()){return/android/i.test(e)}function Wn(e=l()){return/blackberry/i.test(e)}function Qn(e=l()){return/webos/i.test(e)}function Jn(e=l()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Xn(e=l()){return Jn(e)||Gn(e)||Qn(e)||Wn(e)||/windows phone/i.test(e)||Hn(e)}function Yn(e,t=[]){let n;switch(e){case"Browser":n=$n(l());break;case"Worker":n=`${$n(l())}-${e}`;break;default:n=e}const r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${we}/${r}`}class Zn{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,r)=>{try{n(e(t))}catch(e){r(e)}}));n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class er{constructor(e){var t,n,r,i;const s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=s.minPasswordLength)&&void 0!==t?t:6,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),void 0!==s.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),void 0!==s.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),void 0!==s.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),void 0!==s.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(r=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==r?r:"",this.forceUpgradeOnSignin=null!==(i=e.forceUpgradeOnSignin)&&void 0!==i&&i,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,r,i,s,o;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,a),this.validatePasswordCharacterOptions(e,a),a.isValid&&(a.isValid=null===(t=a.meetsMinPasswordLength)||void 0===t||t),a.isValid&&(a.isValid=null===(n=a.meetsMaxPasswordLength)||void 0===n||n),a.isValid&&(a.isValid=null===(r=a.containsLowercaseLetter)||void 0===r||r),a.isValid&&(a.isValid=null===(i=a.containsUppercaseLetter)||void 0===i||i),a.isValid&&(a.isValid=null===(s=a.containsNumericCharacter)||void 0===s||s),a.isValid&&(a.isValid=null===(o=a.containsNonAlphanumericCharacter)||void 0===o||o),a}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class tr{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new rr(this),this.idTokenSubscription=new rr(this),this.beforeStateQueue=new Zn(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Zt,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Un(t)),this._initializationPromise=this.queue((async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await Bn.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUser(e){var t;const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,s=null==r?void 0:r._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==s||!(null==o?void 0:o.user)||(r=o.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return on(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await On(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?D(e):null;return t&&on(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&on(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue((async()=>{await this.assertedPersistence.setPersistence(Un(e))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e,t={}){return yn(e,"GET","/v2/passwordPolicy",mn(e,t))}(this),t=new er(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new m("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise(((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged((()=>{n(),e()}),t)}}))}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return yn(e,"POST","/v2/accounts:revokeToken",mn(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Un(e)||this._popupRedirectResolver;on(t,this,"argument-error"),this.redirectPersistenceManager=await Bn.create(this,[Un(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t);let s=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(on(o,this,"internal-error"),o.then((()=>{s||i(this.currentUser)})),"function"==typeof t){const i=e.addObserver(t,n,r);return()=>{s=!0,i()}}{const n=e.addObserver(t);return()=>{s=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return on(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Yn(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){en.logLevel<=x.WARN&&en.warn(`Auth (${we}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function nr(e){return D(e)}class rr{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new E(e,void 0);return n.subscribe.bind(n)}((e=>this.observer=e))}get next(){return on(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let ir={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function sr(e){return ir.loadJS(e)}function or(e){return`__${e}${Math.floor(1e6*Math.random())}`}class ar{constructor(e){this.type="recaptcha-enterprise",this.auth=nr(e)}async verify(e="verify",t=!1){function n(t,n,r){const i=window.grecaptcha;Tn(i)?i.enterprise.ready((()=>{i.enterprise.execute(t,{action:e}).then((e=>{n(e)})).catch((()=>{n("NO_RECAPTCHA")}))})):r(Error("No reCAPTCHA enterprise script loaded."))}return new Promise(((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((async(t,n)=>{(async function(e,t){return yn(e,"GET","/v2/recaptchaConfig",mn(e,t))})(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((r=>{if(void 0!==r.recaptchaKey){const n=new Sn(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((e=>{n(e)}))}))})(this.auth).then((i=>{if(!t&&Tn(window.grecaptcha))n(i,e,r);else{if("undefined"==typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));let t=ir.recaptchaEnterpriseScript;0!==t.length&&(t+=i),sr(t).then((()=>{n(i,e,r)})).catch((e=>{r(e)}))}})).catch((e=>{r(e)}))}))}}async function cr(e,t,n,r=!1){const i=new ar(e);let s;try{s=await i.verify(n)}catch(e){s=await i.verify(n,!0)}const o=Object.assign({},t);return r?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function ur(e,t,n,r){var i;if(null===(i=e._getRecaptchaConfig())||void 0===i?void 0:i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await cr(e,t,n,"getOobCode"===n);return r(e,i)}return r(e,t).catch((async i=>{if("auth/missing-recaptcha-token"===i.code){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const i=await cr(e,t,n,"getOobCode"===n);return r(e,i)}return Promise.reject(i)}))}function hr(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function lr(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class dr{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return an("not implemented")}_getIdTokenResponse(e){return an("not implemented")}_linkToIdToken(e,t){return an("not implemented")}_getReauthenticationResolver(e){return an("not implemented")}}async function fr(e,t){return yn(e,"POST","/v1/accounts:signUp",t)}async function pr(e,t){return wn(e,"POST","/v1/accounts:signInWithPassword",mn(e,t))}class gr extends dr{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new gr(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new gr(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return ur(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",pr);case"emailLink":return async function(e,t){return wn(e,"POST","/v1/accounts:signInWithEmailLink",mn(e,t))}(e,{email:this._email,oobCode:this._password});default:nn(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return ur(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",fr);case"emailLink":return async function(e,t){return wn(e,"POST","/v1/accounts:signInWithEmailLink",mn(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:nn(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function mr(e,t){return wn(e,"POST","/v1/accounts:signInWithIdp",mn(e,t))}class yr extends dr{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new yr(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):nn("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=Xt(t,["providerId","signInMethod"]);if(!n||!r)return null;const s=new yr(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return mr(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,mr(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,mr(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=_(t)}return e}}const vr={USER_NOT_FOUND:"user-not-found"};class wr extends dr{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new wr({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new wr({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return wn(e,"POST","/v1/accounts:signInWithPhoneNumber",mn(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await wn(e,"POST","/v1/accounts:signInWithPhoneNumber",mn(e,t));if(n.temporaryProof)throw En(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return wn(e,"POST","/v1/accounts:signInWithPhoneNumber",mn(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),vr)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new wr({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class _r{constructor(e){var t,n,r,i,s,o;const a=I(b(e)),c=null!==(t=a.apiKey)&&void 0!==t?t:null,u=null!==(n=a.oobCode)&&void 0!==n?n:null,h=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=a.mode)&&void 0!==r?r:null);on(c&&u&&h,"argument-error"),this.apiKey=c,this.operation=h,this.code=u,this.continueUrl=null!==(i=a.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(s=a.languageCode)&&void 0!==s?s:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=I(b(e)).link,n=t?I(b(t)).deep_link_id:null,r=I(b(e)).deep_link_id;return(r?I(b(r)).link:null)||r||n||t||e}(e);try{return new _r(t)}catch(e){return null}}}class Ir{constructor(){this.providerId=Ir.PROVIDER_ID}static credential(e,t){return gr._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=_r.parseLink(t);return on(n,"argument-error"),gr._fromEmailAndCode(e,n.code,n.tenantId)}}Ir.PROVIDER_ID="password",Ir.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Ir.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class br{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Er extends br{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Tr extends Er{constructor(){super("facebook.com")}static credential(e){return yr._fromParams({providerId:Tr.PROVIDER_ID,signInMethod:Tr.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Tr.credentialFromTaggedObject(e)}static credentialFromError(e){return Tr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Tr.credential(e.oauthAccessToken)}catch(e){return null}}}Tr.FACEBOOK_SIGN_IN_METHOD="facebook.com",Tr.PROVIDER_ID="facebook.com";class Sr extends Er{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return yr._fromParams({providerId:Sr.PROVIDER_ID,signInMethod:Sr.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Sr.credentialFromTaggedObject(e)}static credentialFromError(e){return Sr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Sr.credential(t,n)}catch(e){return null}}}Sr.GOOGLE_SIGN_IN_METHOD="google.com",Sr.PROVIDER_ID="google.com";class Cr extends Er{constructor(){super("github.com")}static credential(e){return yr._fromParams({providerId:Cr.PROVIDER_ID,signInMethod:Cr.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Cr.credentialFromTaggedObject(e)}static credentialFromError(e){return Cr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Cr.credential(e.oauthAccessToken)}catch(e){return null}}}Cr.GITHUB_SIGN_IN_METHOD="github.com",Cr.PROVIDER_ID="github.com";class kr extends Er{constructor(){super("twitter.com")}static credential(e,t){return yr._fromParams({providerId:kr.PROVIDER_ID,signInMethod:kr.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return kr.credentialFromTaggedObject(e)}static credentialFromError(e){return kr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return kr.credential(t,n)}catch(e){return null}}}async function Ar(e,t){return wn(e,"POST","/v1/accounts:signUp",mn(e,t))}kr.TWITTER_SIGN_IN_METHOD="twitter.com",kr.PROVIDER_ID="twitter.com";class Nr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const i=await Mn._fromIdTokenResponse(e,n,r),s=Dr(n);return new Nr({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=Dr(n);return new Nr({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function Dr(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class Rr extends g{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,Rr.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new Rr(e,t,n,r)}}function Or(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw Rr._fromErrorAndOperation(e,n,t,r);throw n}))}async function Pr(e,t,n=!1){const r="signIn",i=await Or(e,r,t),s=await Nr._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(s.user),s}async function Lr(e){const t=nr(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}new WeakMap;const Mr="__sak";class xr{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Mr,"1"),this.storage.removeItem(Mr),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class Ur extends xr{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=l();return zn(e)||Jn(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=Xn(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);!function(){const e=l();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()||10!==document.documentMode||i===e.newValue||e.newValue===e.oldValue?r():setTimeout(r,10)}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Ur.type="LOCAL";const Fr=Ur;class Vr extends xr{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Vr.type="SESSION";const jr=Vr;class Br{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new Br(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,s=this.handlersMap[r];if(!(null==s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(s).map((async e=>e(t.origin,i))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function $r(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}Br.receivers=[];class qr{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,s;return new Promise(((o,a)=>{const c=$r("",20);r.port1.start();const u=setTimeout((()=>{a(new Error("unsupported_event"))}),n);s={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),i=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(i),o(t.data.response);break;default:clearTimeout(u),clearTimeout(i),a(new Error("invalid_response"))}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}function zr(){return window}function Kr(){return void 0!==zr().WorkerGlobalScope&&"function"==typeof zr().importScripts}const Hr="firebaseLocalStorageDb",Gr="firebaseLocalStorage",Wr="fbase_key";class Qr{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function Jr(e,t){return e.transaction([Gr],t?"readwrite":"readonly").objectStore(Gr)}function Xr(){const e=indexedDB.open(Hr,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(Gr,{keyPath:Wr})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(Gr)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(Hr);return new Qr(e).toPromise()}(),t(await Xr()))}))}))}async function Yr(e,t,n){const r=Jr(e,!0).put({[Wr]:t,value:n});return new Qr(r).toPromise()}function Zr(e,t){const n=Jr(e,!0).delete(t);return new Qr(n).toPromise()}class ei{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await Xr()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Kr()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Br._getInstance(Kr()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new qr(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Xr();return await Yr(e,Mr,"1"),await Zr(e,Mr),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>Yr(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=Jr(e,!1).get(t),r=await new Qr(n).toPromise();return void 0===r?null:r.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>Zr(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=Jr(e,!1).getAll();return new Qr(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}ei.type="LOCAL";const ti=ei;or("rcb"),new ln(3e4,6e4);class ni{constructor(e){this.providerId=ni.PROVIDER_ID,this.auth=nr(e)}verifyPhoneNumber(e,t){return async function(e,t,n){var r;const i=await n.verify();try{let s;if(on("string"==typeof i,e,"argument-error"),on("recaptcha"===n.type,e,"argument-error"),s="string"==typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s){on("enroll"===t.type,e,"internal-error");const n=await function(e,t){return yn(e,"POST","/v2/accounts/mfaEnrollment:start",mn(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:i}});return n.phoneSessionInfo.sessionInfo}{on("signin"===t.type,e,"internal-error");const n=(null===(r=s.multiFactorHint)||void 0===r?void 0:r.uid)||s.multiFactorUid;on(n,e,"missing-multi-factor-info");const o=await function(e,t){return yn(e,"POST","/v2/accounts/mfaSignIn:start",mn(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:i}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return yn(e,"POST","/v1/accounts:sendVerificationCode",mn(e,t))}(e,{phoneNumber:s.phoneNumber,recaptchaToken:i});return t}}finally{n._reset()}}(this.auth,e,D(t))}static credential(e,t){return wr._fromVerification(e,t)}static credentialFromResult(e){const t=e;return ni.credentialFromTaggedObject(t)}static credentialFromError(e){return ni.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?wr._fromTokenResponse(t,n):null}}ni.PROVIDER_ID="phone",ni.PHONE_SIGN_IN_METHOD="phone";class ri extends dr{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return mr(e,this._buildIdpRequest())}_linkToIdToken(e,t){return mr(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return mr(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function ii(e){return Pr(e.auth,new ri(e),e.bypassAuthState)}function si(e){const{auth:t,user:n}=e;return on(n,t,"internal-error"),async function(e,t,n=!1){const{auth:r}=e,i="reauthenticate";try{const s=await Nn(e,Or(r,i,t,e),n);on(s.idToken,r,"internal-error");const o=An(s.idToken);on(o,r,"internal-error");const{sub:a}=o;return on(e.uid===a,r,"user-mismatch"),Nr._forOperation(e,i,s)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&nn(r,"user-mismatch"),e}}(n,new ri(e),e.bypassAuthState)}async function oi(e){const{auth:t,user:n}=e;return on(n,t,"internal-error"),async function(e,t,n=!1){const r=await Nn(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return Nr._forOperation(e,"link",r)}(n,new ri(e),e.bypassAuthState)}class ai{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return ii;case"linkViaPopup":case"linkViaRedirect":return oi;case"reauthViaPopup":case"reauthViaRedirect":return si;default:nn(this.auth,"internal-error")}}resolve(e){cn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){cn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const ci=new ln(2e3,1e4);class ui extends ai{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,ui.currentPopupAction&&ui.currentPopupAction.cancel(),ui.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return on(e,this.auth,"internal-error"),e}async onExecution(){cn(1===this.filter.length,"Popup operations only handle one event");const e=$r();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(rn(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(rn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ui.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(rn(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(e,ci.get())};e()}}ui.currentPopupAction=null;const hi="pendingRedirect",li=new Map;class di extends ai{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=li.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=function(e){return jn(hi,e.config.apiKey,e.name)}(t),r=function(e){return Un(e._redirectPersistence)}(e);if(!await r._isAvailable())return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth),n=t?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}li.set(this.auth._key(),e)}return this.bypassAuthState||li.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function fi(e,t){li.set(e._key(),t)}async function pi(e,t,n=!1){const r=nr(e),i=function(e,t){return t?Un(t):(on(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}(r,t),s=new di(r,i,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}class gi{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return yi(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!yi(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(rn(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(mi(e))}saveEventToCache(e){this.cachedEventUids.add(mi(e)),this.lastProcessedEventTime=Date.now()}}function mi(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function yi({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}const vi=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,wi=/^https?/;function _i(e){const t=un(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!wi.test(n))return!1;if(vi.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const Ii=new ln(3e4,6e4);function bi(){const e=zr().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}function Ei(e){return new Promise(((t,n)=>{var r,i,s;function o(){bi(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{bi(),n(rn(e,"network-request-failed"))},timeout:Ii.get()})}if(null===(i=null===(r=zr().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=zr().gapi)||void 0===s?void 0:s.load)){const t=or("iframefcb");return zr()[t]=()=>{gapi.load?o():n(rn(e,"network-request-failed"))},sr(`${ir.gapiScript}?onload=${t}`).catch((e=>n(e)))}o()}})).catch((e=>{throw Ti=null,e}))}let Ti=null;const Si=new ln(5e3,15e3),Ci="__/auth/iframe",ki="emulator/auth/iframe",Ai={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Ni=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Di(e){const t=e.config;on(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?dn(t,ki):`https://${e.config.authDomain}/${Ci}`,r={apiKey:t.apiKey,appName:e.name,v:we},i=Ni.get(e.config.apiHost);i&&(r.eid=i);const s=e._getFrameworks();return s.length&&(r.fw=s.join(",")),`${n}?${_(r).slice(1)}`}const Ri={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Oi{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}const Pi=encodeURIComponent("fac");async function Li(e,t,n,r,i,s){on(e.config.authDomain,e,"auth-domain-config-required"),on(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:we,eventId:i};if(t instanceof br){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(s||{}))o[e]=t}if(t instanceof Er){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const e of Object.keys(a))void 0===a[e]&&delete a[e];const c=await e._getAppCheckToken(),u=c?`#${Pi}=${encodeURIComponent(c)}`:"";return`${function({config:e}){return e.emulator?dn(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${_(a).slice(1)}${u}`}const Mi="webStorageSupport",xi=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=jr,this._completeRedirectFn=pi,this._overrideRedirectResult=fi}async _openPopup(e,t,n,r){var i;return cn(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()"),function(e,t,n,r=500,i=600){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c=Object.assign(Object.assign({},Ri),{width:r.toString(),height:i.toString(),top:s,left:o}),u=l().toLowerCase();n&&(a=Kn(u)?"_blank":n),qn(u)&&(t=t||"http://localhost",c.scrollbars="yes");const h=Object.entries(c).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=l()){var t;return Jn(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(u)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",a),new Oi(null);const d=window.open(t||"",a,h);on(d,e,"popup-blocked");try{d.focus()}catch(e){}return new Oi(d)}(e,await Li(e,t,n,un(),r),$r())}async _openRedirect(e,t,n,r){return await this._originValidation(e),i=await Li(e,t,n,un(),r),zr().location.href=i,new Promise((()=>{}));var i}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(cn(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await async function(e){const t=await function(e){return Ti=Ti||Ei(e),Ti}(e),n=zr().gapi;return on(n,e,"internal-error"),t.open({where:document.body,url:Di(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Ai,dontclear:!0},(t=>new Promise((async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=rn(e,"network-request-failed"),s=zr().setTimeout((()=>{r(i)}),Si.get());function o(){zr().clearTimeout(s),n(t)}t.ping(o).then(o,(()=>{r(i)}))}))))}(e),n=new gi(e);return t.register("authEvent",(t=>(on(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Mi,{type:Mi},(n=>{var r;const i=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r[Mi];void 0!==i&&t(!!i),nn(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return yn(e,"GET","/v1/projects",t)}(e);for(const e of t)try{if(_i(e))return}catch(e){}nn(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Xn()||zn()||Jn()}};var Ui="@firebase/auth",Fi="1.6.1";class Vi{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){on(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const ji=u("authIdTokenMaxAge")||300;let Bi=null;var $i;!function(e){ir=e}({loadJS:e=>new Promise(((t,n)=>{const r=document.createElement("script");var i,s;r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=rn("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",(null!==(s=null===(i=document.getElementsByTagName("head"))||void 0===i?void 0:i[0])&&void 0!==s?s:document).appendChild(r)})),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="}),$i="Browser",ge(new R("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:s,authDomain:o}=n.options;on(s&&!s.includes(":"),"invalid-api-key",{appName:n.name});const a={apiKey:s,authDomain:o,clientPlatform:$i,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Yn($i)},c=new tr(n,r,i,a);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(Un);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(c,t),c}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),ge(new R("auth-internal",(e=>(e=>new Vi(e))(nr(e.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),be(Ui,Fi,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}($i)),be(Ui,Fi,"esm2017");var qi,zi="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Ki={},Hi=Hi||{},Gi=zi||self;function Wi(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function Qi(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var Ji="closure_uid_"+(1e9*Math.random()>>>0),Xi=0;function Yi(e,t,n){return e.call.apply(e.bind,arguments)}function Zi(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function es(e,t,n){return(es=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Yi:Zi).apply(null,arguments)}function ts(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function ns(e,t){function n(){}n.prototype=t.prototype,e.$=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.ac=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function rs(){this.s=this.s,this.o=this.o}rs.prototype.s=!1,rs.prototype.sa=function(){var e;!this.s&&(this.s=!0,this.N(),0)&&(e=this,Object.prototype.hasOwnProperty.call(e,Ji)&&e[Ji]||(e[Ji]=++Xi))},rs.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const is=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function ss(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function os(e,t){for(let t=1;t<arguments.length;t++){const n=arguments[t];if(Wi(n)){const t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function as(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}as.prototype.h=function(){this.defaultPrevented=!0};var cs=function(){if(!Gi.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};Gi.addEventListener("test",e,t),Gi.removeEventListener("test",e,t)}catch(e){}return e}();function us(e){return/^[\s\xa0]*$/.test(e)}function hs(){var e=Gi.navigator;return e&&(e=e.userAgent)?e:""}function ls(e){return-1!=hs().indexOf(e)}function ds(e){return ds[" "](e),e}ds[" "]=function(){};var fs,ps,gs,ms=ls("Opera"),ys=ls("Trident")||ls("MSIE"),vs=ls("Edge"),ws=vs||ys,_s=ls("Gecko")&&!(-1!=hs().toLowerCase().indexOf("webkit")&&!ls("Edge"))&&!(ls("Trident")||ls("MSIE"))&&!ls("Edge"),Is=-1!=hs().toLowerCase().indexOf("webkit")&&!ls("Edge");function bs(){var e=Gi.document;return e?e.documentMode:void 0}e:{var Es="",Ts=(ps=hs(),_s?/rv:([^\);]+)(\)|;)/.exec(ps):vs?/Edge\/([\d\.]+)/.exec(ps):ys?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ps):Is?/WebKit\/(\S+)/.exec(ps):ms?/(?:Version)[ \/]?(\S+)/.exec(ps):void 0);if(Ts&&(Es=Ts?Ts[1]:""),ys){var Ss=bs();if(null!=Ss&&Ss>parseFloat(Es)){fs=String(Ss);break e}}fs=Es}Gi.document&&ys?gs=bs()||parseInt(fs,10)||void 0:gs=void 0;var Cs=gs;function ks(e,t){if(as.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(_s){e:{try{ds(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:As[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&ks.$.h.call(this)}}ns(ks,as);var As={2:"touch",3:"pen",4:"mouse"};ks.prototype.h=function(){ks.$.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var Ns="closure_listenable_"+(1e6*Math.random()|0),Ds=0;function Rs(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.la=i,this.key=++Ds,this.fa=this.ia=!1}function Os(e){e.fa=!0,e.listener=null,e.proxy=null,e.src=null,e.la=null}function Ps(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function Ls(e){const t={};for(const n in e)t[n]=e[n];return t}const Ms="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function xs(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t],r)e[n]=r[n];for(let t=0;t<Ms.length;t++)n=Ms[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function Us(e){this.src=e,this.g={},this.h=0}function Fs(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=is(i,t);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(Os(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function Vs(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.fa&&s.listener==t&&s.capture==!!n&&s.la==r)return i}return-1}Us.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=Vs(e,t,r,i);return-1<o?(t=e[o],n||(t.ia=!1)):((t=new Rs(t,this.src,s,!!r,i)).ia=n,e.push(t)),t};var js="closure_lm_"+(1e6*Math.random()|0),Bs={};function $s(e,t,n,r,i){if(r&&r.once)return zs(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)$s(e,t[s],n,r,i);return null}return n=Xs(n),e&&e[Ns]?e.O(t,n,Qi(r)?!!r.capture:!!r,i):qs(e,t,n,!1,r,i)}function qs(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=Qi(i)?!!i.capture:!!i,a=Qs(e);if(a||(e[js]=a=new Us(e)),(n=a.add(t,n,r,o,s)).proxy)return n;if(r=function(){const e=Ws;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)cs||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(Gs(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function zs(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)zs(e,t[s],n,r,i);return null}return n=Xs(n),e&&e[Ns]?e.P(t,n,Qi(r)?!!r.capture:!!r,i):qs(e,t,n,!0,r,i)}function Ks(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)Ks(e,t[s],n,r,i);else r=Qi(r)?!!r.capture:!!r,n=Xs(n),e&&e[Ns]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=Vs(s=e.g[t],n,r,i))&&(Os(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--))):e&&(e=Qs(e))&&(t=e.g[t.toString()],e=-1,t&&(e=Vs(t,n,r,i)),(n=-1<e?t[e]:null)&&Hs(n))}function Hs(e){if("number"!=typeof e&&e&&!e.fa){var t=e.src;if(t&&t[Ns])Fs(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Gs(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Qs(t))?(Fs(n,e),0==n.h&&(n.src=null,t[js]=null)):Os(e)}}}function Gs(e){return e in Bs?Bs[e]:Bs[e]="on"+e}function Ws(e,t){if(e.fa)e=!0;else{t=new ks(t,this);var n=e.listener,r=e.la||e.src;e.ia&&Hs(e),e=n.call(r,t)}return e}function Qs(e){return(e=e[js])instanceof Us?e:null}var Js="__closure_events_fn_"+(1e9*Math.random()>>>0);function Xs(e){return"function"==typeof e?e:(e[Js]||(e[Js]=function(t){return e.handleEvent(t)}),e[Js])}function Ys(){rs.call(this),this.i=new Us(this),this.S=this,this.J=null}function Zs(e,t){var n,r=e.J;if(r)for(n=[];r;r=r.J)n.push(r);if(e=e.S,r=t.type||t,"string"==typeof t)t=new as(t,e);else if(t instanceof as)t.target=t.target||e;else{var i=t;xs(t=new as(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=eo(o,r,!0,t)&&i}if(i=eo(o=t.g=e,r,!0,t)&&i,i=eo(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=eo(o=t.g=n[s],r,!1,t)&&i}function eo(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&Fs(e.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}ns(Ys,rs),Ys.prototype[Ns]=!0,Ys.prototype.removeEventListener=function(e,t,n,r){Ks(this,e,t,n,r)},Ys.prototype.N=function(){if(Ys.$.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)Os(n[r]);delete t.g[e],t.h--}}this.J=null},Ys.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},Ys.prototype.P=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var to=Gi.JSON.stringify;function no(){var e=uo;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var ro=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new io),(e=>e.reset()));class io{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function so(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function oo(e){Gi.setTimeout((()=>{throw e}),0)}let ao,co=!1,uo=new class{constructor(){this.h=this.g=null}add(e,t){const n=ro.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},ho=()=>{const e=Gi.Promise.resolve(void 0);ao=()=>{e.then(lo)}};var lo=()=>{for(var e;e=no();){try{e.h.call(e.g)}catch(e){oo(e)}var t=ro;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}co=!1};function fo(e,t){Ys.call(this),this.h=e||1,this.g=t||Gi,this.j=es(this.qb,this),this.l=Date.now()}function po(e){e.ga=!1,e.T&&(e.g.clearTimeout(e.T),e.T=null)}function go(e,t,n){if("function"==typeof e)n&&(e=es(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=es(e.handleEvent,e)}return 2147483647<Number(t)?-1:Gi.setTimeout(e,t||0)}function mo(e){e.g=go((()=>{e.g=null,e.i&&(e.i=!1,mo(e))}),e.j);const t=e.h;e.h=null,e.m.apply(null,t)}ns(fo,Ys),(qi=fo.prototype).ga=!1,qi.T=null,qi.qb=function(){if(this.ga){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-e):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Zs(this,"tick"),this.ga&&(po(this),this.start()))}},qi.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},qi.N=function(){fo.$.N.call(this),po(this),delete this.g};class yo extends rs{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:mo(this)}N(){super.N(),this.g&&(Gi.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function vo(e){rs.call(this),this.h=e,this.g={}}ns(vo,rs);var wo=[];function _o(e,t,n,r){Array.isArray(n)||(n&&(wo[0]=n.toString()),n=wo);for(var i=0;i<n.length;i++){var s=$s(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function Io(e){Ps(e.g,(function(e,t){this.g.hasOwnProperty(t)&&Hs(e)}),e),e.g={}}function bo(){this.g=!0}function Eo(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return to(n)}catch(e){return t}}(e,n)+(r?" "+r:"")}))}vo.prototype.N=function(){vo.$.N.call(this),Io(this)},vo.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},bo.prototype.Ea=function(){this.g=!1},bo.prototype.info=function(){};var To={},So=null;function Co(){return So=So||new Ys}function ko(e){as.call(this,To.Ta,e)}function Ao(e){const t=Co();Zs(t,new ko(t))}function No(e,t){as.call(this,To.STAT_EVENT,e),this.stat=t}function Do(e){const t=Co();Zs(t,new No(t,e))}function Ro(e,t){as.call(this,To.Ua,e),this.size=t}function Oo(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return Gi.setTimeout((function(){e()}),t)}To.Ta="serverreachability",ns(ko,as),To.STAT_EVENT="statevent",ns(No,as),To.Ua="timingevent",ns(Ro,as);var Po={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Lo={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Mo(){}function xo(e){return e.h||(e.h=e.i())}function Uo(){}Mo.prototype.h=null;var Fo,Vo={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function jo(){as.call(this,"d")}function Bo(){as.call(this,"c")}function $o(){}function qo(e,t,n,r){this.l=e,this.j=t,this.m=n,this.W=r||1,this.U=new vo(this),this.P=Ko,e=ws?125:void 0,this.V=new fo(e),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new zo}function zo(){this.i=null,this.g="",this.h=!1}ns(jo,as),ns(Bo,as),ns($o,Mo),$o.prototype.g=function(){return new XMLHttpRequest},$o.prototype.i=function(){return{}},Fo=new $o;var Ko=45e3,Ho={},Go={};function Wo(e,t,n){e.L=1,e.A=fa(ca(t)),e.u=n,e.S=!0,Qo(e,null)}function Qo(e,t){e.G=Date.now(),Zo(e),e.B=ca(e.A);var n=e.B,r=e.W;Array.isArray(r)||(r=[String(r)]),Ca(n.i,"t",r),e.o=0,n=e.l.J,e.h=new zo,e.g=Cc(e.l,n?t:null,!e.u),0<e.O&&(e.M=new yo(es(e.Pa,e,e.g),e.O)),_o(e.U,e.g,"readystatechange",e.nb),t=e.I?Ls(e.I):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ha(e.B,e.v,e.u,t)):(e.v="GET",e.g.ha(e.B,e.v,null,t)),Ao(),function(e,t,n,r,i,s){e.info((function(){if(e.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var h=u[0];u=u[1];var l=h.split("_");o=2<=l.length&&"type"==l[1]?o+(h+"=")+u+"&":o+(h+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.v,e.B,e.m,e.W,e.u)}function Jo(e){return!!e.g&&"GET"==e.v&&2!=e.L&&e.l.Ha}function Xo(e,t,n){let r,i=!0;for(;!e.J&&e.o<n.length;){if(r=Yo(e,n),r==Go){4==t&&(e.s=4,Do(14),i=!1),Eo(e.j,e.m,null,"[Incomplete Response]");break}if(r==Ho){e.s=4,Do(15),Eo(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}Eo(e.j,e.m,r,null),ia(e,r)}Jo(e)&&0!=e.o&&(e.h.g=e.h.g.slice(e.o),e.o=0),4!=t||0!=n.length||e.h.h||(e.s=1,Do(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.ba&&(e.ba=!0,(t=e.l).g==e&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),vc(t),t.M=!0,Do(11))):(Eo(e.j,e.m,n,"[Invalid Chunked Response]"),ra(e),na(e))}function Yo(e,t){var n=e.o,r=t.indexOf("\n",n);return-1==r?Go:(n=Number(t.substring(n,r)),isNaN(n)?Ho:(r+=1)+n>t.length?Go:(t=t.slice(r,r+n),e.o=r+n,t))}function Zo(e){e.Y=Date.now()+e.P,ea(e,e.P)}function ea(e,t){if(null!=e.C)throw Error("WatchDog timer not null");e.C=Oo(es(e.lb,e),t)}function ta(e){e.C&&(Gi.clearTimeout(e.C),e.C=null)}function na(e){0==e.l.H||e.J||Ic(e.l,e)}function ra(e){ta(e);var t=e.M;t&&"function"==typeof t.sa&&t.sa(),e.M=null,po(e.V),Io(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.sa())}function ia(e,t){try{var n=e.l;if(0!=n.H&&(n.g==e||Pa(n.i,e)))if(!e.K&&Pa(n.i,e)&&3==n.H){try{var r=n.Ja.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.G+3e3<e.G))break e;_c(n),hc(n)}yc(n),Do(18)}}else n.Fa=i[1],0<n.Fa-n.V&&37500>i[2]&&n.G&&0==n.A&&!n.v&&(n.v=Oo(es(n.ib,n),6e3));if(1>=Oa(n.i)&&n.oa){try{n.oa()}catch(e){}n.oa=void 0}}else Ec(n,11)}else if((e.K||n.g==e)&&_c(n),!us(t))for(i=n.Ja.g.parse(t),t=0;t<i.length;t++){let u=i[t];if(n.V=u[0],u=u[1],2==n.H)if("c"==u[0]){n.K=u[1],n.pa=u[2];const t=u[3];null!=t&&(n.ra=t,n.l.info("VER="+n.ra));const i=u[4];null!=i&&(n.Ga=i,n.l.info("SVER="+n.Ga));const h=u[5];null!=h&&"number"==typeof h&&0<h&&(r=1.5*h,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;const l=e.g;if(l){const e=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.i;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(La(s,s.h),s.h=null))}if(r.F){const e=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.Da=e,da(r.I,r.F,e))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-e.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=e;if((r=n).wa=Sc(r,r.J?r.pa:null,r.Y),o.K){Ma(r.i,o);var a=o,c=r.L;c&&a.setTimeout(c),a.C&&(ta(a),Zo(a)),r.g=o}else mc(r);0<n.j.length&&dc(n)}else"stop"!=u[0]&&"close"!=u[0]||Ec(n,7);else 3==n.H&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?Ec(n,7):uc(n):"noop"!=u[0]&&n.h&&n.h.Aa(u),n.A=0)}Ao()}catch(e){}}function sa(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(Wi(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.ta&&"function"==typeof e.ta)return e.ta();if(!e.Z||"function"!=typeof e.Z){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(Wi(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.Z&&"function"==typeof e.Z)return e.Z();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(Wi(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}(qi=qo.prototype).setTimeout=function(e){this.P=e},qi.nb=function(e){e=e.target;const t=this.M;t&&3==rc(e)?t.l():this.Pa(e)},qi.Pa=function(e){try{if(e==this.g)e:{const h=rc(this.g);var t=this.g.Ia();if(this.g.da(),!(3>h)&&(3!=h||ws||this.g&&(this.h.h||this.g.ja()||ic(this.g)))){this.J||4!=h||7==t||Ao(),ta(this);var n=this.g.da();this.ca=n;t:if(Jo(this)){var r=ic(this.g);e="";var i=r.length,s=4==rc(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){ra(this),na(this);var o="";break t}this.h.i=new Gi.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.length=0,this.h.g+=e,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(e,t,n,r,i,s,o){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o}))}(this.j,this.v,this.B,this.m,this.W,h,n),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!us(a)){var u=a;break t}}u=null}if(!(n=u)){this.i=!1,this.s=3,Do(12),ra(this),na(this);break e}Eo(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ia(this,n)}this.S?(Xo(this,h,o),ws&&this.i&&3==h&&(_o(this.U,this.V,"tick",this.mb),this.V.start())):(Eo(this.j,this.m,o,null),ia(this,o)),4==h&&ra(this),this.i&&!this.J&&(4==h?Ic(this.l,this):(this.i=!1,Zo(this)))}else(function(e){const t={};e=(e.g&&2<=rc(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(us(e[r]))continue;var n=so(e[r]);const i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=t[i]||[];t[i]=s,s.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.s=3,Do(12)):(this.s=0,Do(13)),ra(this),na(this)}}}catch(e){}},qi.mb=function(){if(this.g){var e=rc(this.g),t=this.g.ja();this.o<t.length&&(ta(this),Xo(this,e,t),this.i&&4!=e&&Zo(this))}},qi.cancel=function(){this.J=!0,ra(this)},qi.lb=function(){this.C=null;const e=Date.now();0<=e-this.Y?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.B),2!=this.L&&(Ao(),Do(17)),ra(this),this.s=2,na(this)):ea(this,this.Y-e)};var oa=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function aa(e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof aa){this.h=e.h,ua(this,e.j),this.s=e.s,this.g=e.g,ha(this,e.m),this.l=e.l;var t=e.i,n=new ba;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),la(this,n),this.o=e.o}else e&&(t=String(e).match(oa))?(this.h=!1,ua(this,t[1]||"",!0),this.s=pa(t[2]||""),this.g=pa(t[3]||"",!0),ha(this,t[4]),this.l=pa(t[5]||"",!0),la(this,t[6]||"",!0),this.o=pa(t[7]||"")):(this.h=!1,this.i=new ba(null,this.h))}function ca(e){return new aa(e)}function ua(e,t,n){e.j=n?pa(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function ha(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function la(e,t,n){t instanceof ba?(e.i=t,function(e,t){t&&!e.j&&(Ea(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(Ta(this,t),Ca(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=ga(t,_a)),e.i=new ba(t,e.h))}function da(e,t,n){e.i.set(t,n)}function fa(e){return da(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function pa(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function ga(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,ma),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function ma(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}aa.prototype.toString=function(){var e=[],t=this.j;t&&e.push(ga(t,ya,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(ga(t,ya,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(ga(n,"/"==n.charAt(0)?wa:va,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",ga(n,Ia)),e.join("")};var ya=/[#\/\?@]/g,va=/[#\?:]/g,wa=/[#\?]/g,_a=/[#\?@]/g,Ia=/#/g;function ba(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Ea(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function Ta(e,t){Ea(e),t=ka(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Sa(e,t){return Ea(e),t=ka(e,t),e.g.has(t)}function Ca(e,t,n){Ta(e,t),0<n.length&&(e.i=null,e.g.set(ka(e,t),ss(n)),e.h+=n.length)}function ka(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(qi=ba.prototype).add=function(e,t){Ea(this),this.i=null,e=ka(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},qi.forEach=function(e,t){Ea(this),this.g.forEach((function(n,r){n.forEach((function(n){e.call(t,n,r,this)}),this)}),this)},qi.ta=function(){Ea(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},qi.Z=function(e){Ea(this);let t=[];if("string"==typeof e)Sa(this,e)&&(t=t.concat(this.g.get(ka(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},qi.set=function(e,t){return Ea(this),this.i=null,Sa(this,e=ka(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},qi.get=function(e,t){return e&&0<(e=this.Z(e)).length?String(e[0]):t},qi.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),e.push(i)}}return this.i=e.join("&")};var Aa=class{constructor(e,t){this.g=e,this.map=t}};function Na(e){this.l=e||Da,e=Gi.PerformanceNavigationTiming?0<(e=Gi.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(Gi.g&&Gi.g.Ka&&Gi.g.Ka()&&Gi.g.Ka().dc),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Da=10;function Ra(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Oa(e){return e.h?1:e.g?e.g.size:0}function Pa(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function La(e,t){e.g?e.g.add(t):e.h=t}function Ma(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function xa(e){if(null!=e.h)return e.i.concat(e.h.F);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.F);return t}return ss(e.i)}Na.prototype.cancel=function(){if(this.i=xa(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var Ua=class{stringify(e){return Gi.JSON.stringify(e,void 0)}parse(e){return Gi.JSON.parse(e,void 0)}};function Fa(){this.g=new Ua}function Va(e,t,n){const r=n||"";try{sa(e,(function(e,n){let i=e;Qi(e)&&(i=to(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}function ja(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function Ba(e){this.l=e.ec||null,this.j=e.ob||!1}function $a(e,t){Ys.call(this),this.F=e,this.u=t,this.m=void 0,this.readyState=qa,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}ns(Ba,Mo),Ba.prototype.g=function(){return new $a(this.l,this.j)},Ba.prototype.i=function(e){return function(){return e}}({}),ns($a,Ys);var qa=0;function za(e){e.j.read().then(e.Xa.bind(e)).catch(e.ka.bind(e))}function Ka(e){e.readyState=4,e.l=null,e.j=null,e.A=null,Ha(e)}function Ha(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(qi=$a.prototype).open=function(e,t){if(this.readyState!=qa)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,Ha(this)},qi.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.F||Gi).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))},qi.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Ka(this)),this.readyState=qa},qi.$a=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Ha(this)),this.g&&(this.readyState=3,Ha(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==Gi.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;za(this)}else e.text().then(this.Za.bind(this),this.ka.bind(this))},qi.Xa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Ka(this):Ha(this),3==this.readyState&&za(this)}},qi.Za=function(e){this.g&&(this.response=this.responseText=e,Ka(this))},qi.Ya=function(e){this.g&&(this.response=e,Ka(this))},qi.ka=function(){this.g&&Ka(this)},qi.setRequestHeader=function(e,t){this.v.append(e,t)},qi.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},qi.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty($a.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var Ga=Gi.JSON.parse;function Wa(e){Ys.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Qa,this.L=this.M=!1}ns(Wa,Ys);var Qa="",Ja=/^https?$/i,Xa=["POST","PUT"];function Ya(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,Za(e),tc(e)}function Za(e){e.F||(e.F=!0,Zs(e,"complete"),Zs(e,"error"))}function ec(e){if(e.h&&void 0!==Hi&&(!e.C[1]||4!=rc(e)||2!=e.da()))if(e.v&&4==rc(e))go(e.La,0,e);else if(Zs(e,"readystatechange"),4==rc(e)){e.h=!1;try{const o=e.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===o){var i=String(e.I).match(oa)[1]||null;!i&&Gi.self&&Gi.self.location&&(i=Gi.self.location.protocol.slice(0,-1)),r=!Ja.test(i?i.toLowerCase():"")}n=r}if(n)Zs(e,"complete"),Zs(e,"success");else{e.m=6;try{var s=2<rc(e)?e.g.statusText:""}catch(e){s=""}e.j=s+" ["+e.da()+"]",Za(e)}}finally{tc(e)}}}function tc(e,t){if(e.g){nc(e);const n=e.g,r=e.C[0]?()=>{}:null;e.g=null,e.C=null,t||Zs(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function nc(e){e.g&&e.L&&(e.g.ontimeout=null),e.A&&(Gi.clearTimeout(e.A),e.A=null)}function rc(e){return e.g?e.g.readyState:0}function ic(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.K){case Qa:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function sc(e){let t="";return Ps(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function oc(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=sc(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):da(e,t,n))}function ac(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function cc(e){this.Ga=0,this.j=[],this.l=new bo,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=ac("failFast",!1,e),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=ac("baseRetryDelayMs",5e3,e),this.hb=ac("retryDelaySeedMs",1e4,e),this.eb=ac("forwardChannelMaxRetries",2,e),this.xa=ac("forwardChannelRequestTimeoutMs",2e4,e),this.va=e&&e.xmlHttpFactory||void 0,this.Ha=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.i=new Na(e&&e.concurrentRequestLimit),this.Ja=new Fa,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=e&&e.bc||!1,e&&e.Ea&&this.l.Ea(),e&&e.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&e&&e.detectBufferingProxy||!1,this.qa=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.qa=e.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function uc(e){if(lc(e),3==e.H){var t=e.W++,n=ca(e.I);if(da(n,"SID",e.K),da(n,"RID",t),da(n,"TYPE","terminate"),pc(e,n),(t=new qo(e,e.l,t)).L=2,t.A=fa(ca(n)),n=!1,Gi.navigator&&Gi.navigator.sendBeacon)try{n=Gi.navigator.sendBeacon(t.A.toString(),"")}catch(e){}!n&&Gi.Image&&((new Image).src=t.A,n=!0),n||(t.g=Cc(t.l,null),t.g.ha(t.A)),t.G=Date.now(),Zo(t)}Tc(e)}function hc(e){e.g&&(vc(e),e.g.cancel(),e.g=null)}function lc(e){hc(e),e.u&&(Gi.clearTimeout(e.u),e.u=null),_c(e),e.i.cancel(),e.m&&("number"==typeof e.m&&Gi.clearTimeout(e.m),e.m=null)}function dc(e){if(!Ra(e.i)&&!e.m){e.m=!0;var t=e.Na;ao||ho(),co||(ao(),co=!0),uo.add(t,e),e.C=0}}function fc(e,t){var n;n=t?t.m:e.W++;const r=ca(e.I);da(r,"SID",e.K),da(r,"RID",n),da(r,"AID",e.V),pc(e,r),e.o&&e.s&&oc(r,e.o,e.s),n=new qo(e,e.l,n,e.C+1),null===e.o&&(n.I=e.s),t&&(e.j=t.F.concat(e.j)),t=gc(e,n,1e3),n.setTimeout(Math.round(.5*e.xa)+Math.round(.5*e.xa*Math.random())),La(e.i,n),Wo(n,r,t)}function pc(e,t){e.na&&Ps(e.na,(function(e,n){da(t,n,e)})),e.h&&sa({},(function(e,n){da(t,n,e)}))}function gc(e,t,n){n=Math.min(e.j.length,n);var r=e.h?es(e.h.Va,e.h,e):null;e:{var i=e.j;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=i[o].g;const a=i[o].map;if(n-=t,0>n)t=Math.max(0,i[o].g-100),s=!1;else try{Va(a,e,"req"+n+"_")}catch(e){r&&r(a)}}if(s){r=e.join("&");break e}}}return e=e.j.splice(0,n),t.F=e,r}function mc(e){if(!e.g&&!e.u){e.ba=1;var t=e.Ma;ao||ho(),co||(ao(),co=!0),uo.add(t,e),e.A=0}}function yc(e){return!(e.g||e.u||3<=e.A||(e.ba++,e.u=Oo(es(e.Ma,e),bc(e,e.A)),e.A++,0))}function vc(e){null!=e.B&&(Gi.clearTimeout(e.B),e.B=null)}function wc(e){e.g=new qo(e,e.l,"rpc",e.ba),null===e.o&&(e.g.I=e.s),e.g.O=0;var t=ca(e.wa);da(t,"RID","rpc"),da(t,"SID",e.K),da(t,"AID",e.V),da(t,"CI",e.G?"0":"1"),!e.G&&e.qa&&da(t,"TO",e.qa),da(t,"TYPE","xmlhttp"),pc(e,t),e.o&&e.s&&oc(t,e.o,e.s),e.L&&e.g.setTimeout(e.L);var n=e.g;e=e.pa,n.L=1,n.A=fa(ca(t)),n.u=null,n.S=!0,Qo(n,e)}function _c(e){null!=e.v&&(Gi.clearTimeout(e.v),e.v=null)}function Ic(e,t){var n=null;if(e.g==t){_c(e),vc(e),e.g=null;var r=2}else{if(!Pa(e.i,t))return;n=t.F,Ma(e.i,t),r=1}if(0!=e.H)if(t.i)if(1==r){n=t.u?t.u.length:0,t=Date.now()-t.G;var i=e.C;Zs(r=Co(),new Ro(r,n)),dc(e)}else mc(e);else if(3==(i=t.s)||0==i&&0<t.ca||!(1==r&&function(e,t){return!(Oa(e.i)>=e.i.j-(e.m?1:0)||(e.m?(e.j=t.F.concat(e.j),0):1==e.H||2==e.H||e.C>=(e.cb?0:e.eb)||(e.m=Oo(es(e.Na,e,t),bc(e,e.C)),e.C++,0)))}(e,t)||2==r&&yc(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),i){case 1:Ec(e,5);break;case 4:Ec(e,10);break;case 3:Ec(e,6);break;default:Ec(e,2)}}function bc(e,t){let n=e.ab+Math.floor(Math.random()*e.hb);return e.isActive()||(n*=2),n*t}function Ec(e,t){if(e.l.info("Error code "+t),2==t){var n=null;e.h&&(n=null);var r=es(e.pb,e);n||(n=new aa("//www.google.com/images/cleardot.gif"),Gi.location&&"http"==Gi.location.protocol||ua(n,"https"),fa(n)),function(e,t){const n=new bo;if(Gi.Image){const r=new Image;r.onload=ts(ja,n,r,"TestLoadImage: loaded",!0,t),r.onerror=ts(ja,n,r,"TestLoadImage: error",!1,t),r.onabort=ts(ja,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=ts(ja,n,r,"TestLoadImage: timeout",!1,t),Gi.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(n.toString(),r)}else Do(2);e.H=0,e.h&&e.h.za(t),Tc(e),lc(e)}function Tc(e){if(e.H=0,e.ma=[],e.h){const t=xa(e.i);0==t.length&&0==e.j.length||(os(e.ma,t),os(e.ma,e.j),e.i.i.length=0,ss(e.j),e.j.length=0),e.h.ya()}}function Sc(e,t,n){var r=n instanceof aa?ca(n):new aa(n);if(""!=r.g)t&&(r.g=t+"."+r.g),ha(r,r.m);else{var i=Gi.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new aa(null);r&&ua(s,r),t&&(s.g=t),i&&ha(s,i),n&&(s.l=n),r=s}return n=e.F,t=e.Da,n&&t&&da(r,n,t),da(r,"VER",e.ra),pc(e,r),r}function Cc(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ha&&!e.va?new Wa(new Ba({ob:n})):new Wa(e.va)).Oa(e.J),t}function kc(){}function Ac(){if(ys&&!(10<=Number(Cs)))throw Error("Environmental error: no available transport.")}function Nc(e,t){Ys.call(this),this.g=new cc(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(e?e["X-WebChannel-Client-Profile"]=t.Ca:e={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=e,(e=t&&t.cc)&&!us(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!us(t)&&(this.g.F=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new Oc(this)}function Dc(e){jo.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function Rc(){Bo.call(this),this.status=1}function Oc(e){this.g=e}function Pc(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function Lc(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],o=t+(s^n&(i^s))+r[0]+3614090360&4294967295;o=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=n+(o<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^s&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(n^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(i^(n|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(t=n+((o=t+(i^(n|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(t^(s|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+s&4294967295}function Mc(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}(qi=Wa.prototype).Oa=function(e){this.M=e},qi.ha=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+e);t=t?t.toUpperCase():"GET",this.I=e,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Fo.g(),this.C=this.u?xo(this.u):xo(Fo),this.g.onreadystatechange=es(this.La,this);try{this.G=!0,this.g.open(t,String(e),!0),this.G=!1}catch(e){return void Ya(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),i=Gi.FormData&&e instanceof Gi.FormData,!(0<=is(Xa,t))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of n)this.g.setRequestHeader(e,t);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{nc(this),0<this.B&&((this.L=function(e){return ys&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=es(this.ua,this)):this.A=go(this.ua,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){Ya(this,e)}},qi.ua=function(){void 0!==Hi&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Zs(this,"timeout"),this.abort(8))},qi.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,Zs(this,"complete"),Zs(this,"abort"),tc(this))},qi.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),tc(this,!0)),Wa.$.N.call(this)},qi.La=function(){this.s||(this.G||this.v||this.l?ec(this):this.kb())},qi.kb=function(){ec(this)},qi.isActive=function(){return!!this.g},qi.da=function(){try{return 2<rc(this)?this.g.status:-1}catch(e){return-1}},qi.ja=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},qi.Wa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Ga(t)}},qi.Ia=function(){return this.m},qi.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(qi=cc.prototype).ra=8,qi.H=1,qi.Na=function(e){if(this.m)if(this.m=null,1==this.H){if(!e){this.W=Math.floor(1e5*Math.random()),e=this.W++;const i=new qo(this,this.l,e);let s=this.s;if(this.U&&(s?(s=Ls(s),xs(s,this.U)):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)e:{for(var t=0,n=0;n<this.j.length;n++){var r=this.j[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.j.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=gc(this,i,t),da(n=ca(this.I),"RID",e),da(n,"CVER",22),this.F&&da(n,"X-HTTP-Session-Id",this.F),pc(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(sc(s)))+"&"+t:this.o&&oc(n,this.o,s)),La(this.i,i),this.bb&&da(n,"TYPE","init"),this.P?(da(n,"$req",t),da(n,"SID","null"),i.aa=!0,Wo(i,n,null)):Wo(i,n,t),this.H=2}}else 3==this.H&&(e?fc(this,e):0==this.j.length||Ra(this.i)||fc(this))},qi.Ma=function(){if(this.u=null,wc(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var e=2*this.S;this.l.info("BP detection timer enabled: "+e),this.B=Oo(es(this.jb,this),e)}},qi.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Do(10),hc(this),wc(this))},qi.ib=function(){null!=this.v&&(this.v=null,hc(this),yc(this),Do(19))},qi.pb=function(e){e?(this.l.info("Successfully pinged google.com"),Do(2)):(this.l.info("Failed to ping google.com"),Do(1))},qi.isActive=function(){return!!this.h&&this.h.isActive(this)},(qi=kc.prototype).Ba=function(){},qi.Aa=function(){},qi.za=function(){},qi.ya=function(){},qi.isActive=function(){return!0},qi.Va=function(){},Ac.prototype.g=function(e,t){return new Nc(e,t)},ns(Nc,Ys),Nc.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var e=this.g,t=this.l,n=this.h||void 0;Do(0),e.Y=t,e.na=n||{},e.G=e.aa,e.I=Sc(e,null,e.Y),dc(e)},Nc.prototype.close=function(){uc(this.g)},Nc.prototype.u=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=to(e),e=n);t.j.push(new Aa(t.fb++,e)),3==t.H&&dc(t)},Nc.prototype.N=function(){this.g.h=null,delete this.j,uc(this.g),delete this.g,Nc.$.N.call(this)},ns(Dc,jo),ns(Rc,Bo),ns(Oc,kc),Oc.prototype.Ba=function(){Zs(this.g,"a")},Oc.prototype.Aa=function(e){Zs(this.g,new Dc(e))},Oc.prototype.za=function(e){Zs(this.g,new Rc)},Oc.prototype.ya=function(){Zs(this.g,"b")},ns(Pc,(function(){this.blockSize=-1})),Pc.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Pc.prototype.j=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=this.m,i=this.h,s=0;s<t;){if(0==i)for(;s<=n;)Lc(this,e,s),s+=this.blockSize;if("string"==typeof e){for(;s<t;)if(r[i++]=e.charCodeAt(s++),i==this.blockSize){Lc(this,r),i=0;break}}else for(;s<t;)if(r[i++]=e[s++],i==this.blockSize){Lc(this,r),i=0;break}}this.h=i,this.i+=t},Pc.prototype.l=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.i;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.j(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var xc={};function Uc(e){return-128<=e&&128>e?function(e,t){var n=xc;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=function(e){return new Mc([0|e],0>e?-1:0)}(e)}(e):new Mc([0|e],0>e?-1:0)}function Fc(e){if(isNaN(e)||!isFinite(e))return jc;if(0>e)return Kc(Fc(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=Vc;return new Mc(t,0)}var Vc=4294967296,jc=Uc(0),Bc=Uc(1),$c=Uc(16777216);function qc(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function zc(e){return-1==e.h}function Kc(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new Mc(n,~e.h).add(Bc)}function Hc(e,t){return e.add(Kc(t))}function Gc(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function Wc(e,t){this.g=e,this.h=t}function Qc(e,t){if(qc(t))throw Error("division by zero");if(qc(e))return new Wc(jc,jc);if(zc(e))return t=Qc(Kc(e),t),new Wc(Kc(t.g),Kc(t.h));if(zc(t))return t=Qc(e,Kc(t)),new Wc(Kc(t.g),t.h);if(30<e.g.length){if(zc(e)||zc(t))throw Error("slowDivide_ only works with positive integers.");for(var n=Bc,r=t;0>=r.X(e);)n=Jc(n),r=Jc(r);var i=Xc(n,1),s=Xc(r,1);for(r=Xc(r,2),n=Xc(n,2);!qc(r);){var o=s.add(r);0>=o.X(e)&&(i=i.add(n),s=o),r=Xc(r,1),n=Xc(n,1)}return t=Hc(e,i.R(t)),new Wc(i,t)}for(i=jc;0<=e.X(t);){for(n=Math.max(1,Math.floor(e.ea()/t.ea())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),o=(s=Fc(n)).R(t);zc(o)||0<o.X(e);)o=(s=Fc(n-=r)).R(t);qc(s)&&(s=Bc),i=i.add(s),e=Hc(e,o)}return new Wc(i,e)}function Jc(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.D(r)<<1|e.D(r-1)>>>31;return new Mc(n,e.h)}function Xc(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,i=[],s=0;s<r;s++)i[s]=0<t?e.D(s+n)>>>t|e.D(s+n+1)<<32-t:e.D(s+n);return new Mc(i,e.h)}(qi=Mc.prototype).ea=function(){if(zc(this))return-Kc(this).ea();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.D(n);e+=(0<=r?r:Vc+r)*t,t*=Vc}return e},qi.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(qc(this))return"0";if(zc(this))return"-"+Kc(this).toString(e);for(var t=Fc(Math.pow(e,6)),n=this,r="";;){var i=Qc(n,t).g,s=((0<(n=Hc(n,i.R(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(qc(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},qi.D=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},qi.X=function(e){return zc(e=Hc(this,e))?-1:qc(e)?0:1},qi.abs=function(){return zc(this)?Kc(this):this},qi.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,i=0;i<=t;i++){var s=r+(65535&this.D(i))+(65535&e.D(i)),o=(s>>>16)+(this.D(i)>>>16)+(e.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,n[i]=o<<16|s}return new Mc(n,-2147483648&n[n.length-1]?-1:0)},qi.R=function(e){if(qc(this)||qc(e))return jc;if(zc(this))return zc(e)?Kc(this).R(Kc(e)):Kc(Kc(this).R(e));if(zc(e))return Kc(this.R(Kc(e)));if(0>this.X($c)&&0>e.X($c))return Fc(this.ea()*e.ea());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var s=this.D(r)>>>16,o=65535&this.D(r),a=e.D(i)>>>16,c=65535&e.D(i);n[2*r+2*i]+=o*c,Gc(n,2*r+2*i),n[2*r+2*i+1]+=s*c,Gc(n,2*r+2*i+1),n[2*r+2*i+1]+=o*a,Gc(n,2*r+2*i+1),n[2*r+2*i+2]+=s*a,Gc(n,2*r+2*i+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new Mc(n,0)},qi.gb=function(e){return Qc(this,e).h},qi.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)&e.D(r);return new Mc(n,this.h&e.h)},qi.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)|e.D(r);return new Mc(n,this.h|e.h)},qi.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)^e.D(r);return new Mc(n,this.h^e.h)},Ac.prototype.createWebChannel=Ac.prototype.g,Nc.prototype.send=Nc.prototype.u,Nc.prototype.open=Nc.prototype.m,Nc.prototype.close=Nc.prototype.close,Po.NO_ERROR=0,Po.TIMEOUT=8,Po.HTTP_ERROR=6,Lo.COMPLETE="complete",Uo.EventType=Vo,Vo.OPEN="a",Vo.CLOSE="b",Vo.ERROR="c",Vo.MESSAGE="d",Ys.prototype.listen=Ys.prototype.O,Wa.prototype.listenOnce=Wa.prototype.P,Wa.prototype.getLastError=Wa.prototype.Sa,Wa.prototype.getLastErrorCode=Wa.prototype.Ia,Wa.prototype.getStatus=Wa.prototype.da,Wa.prototype.getResponseJson=Wa.prototype.Wa,Wa.prototype.getResponseText=Wa.prototype.ja,Wa.prototype.send=Wa.prototype.ha,Wa.prototype.setWithCredentials=Wa.prototype.Oa,Pc.prototype.digest=Pc.prototype.l,Pc.prototype.reset=Pc.prototype.reset,Pc.prototype.update=Pc.prototype.j,Mc.prototype.add=Mc.prototype.add,Mc.prototype.multiply=Mc.prototype.R,Mc.prototype.modulo=Mc.prototype.gb,Mc.prototype.compare=Mc.prototype.X,Mc.prototype.toNumber=Mc.prototype.ea,Mc.prototype.toString=Mc.prototype.toString,Mc.prototype.getBits=Mc.prototype.D,Mc.fromNumber=Fc,Mc.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return Kc(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=Fc(Math.pow(n,8)),i=jc,s=0;s<t.length;s+=8){var o=Math.min(8,t.length-s),a=parseInt(t.substring(s,s+o),n);8>o?(o=Fc(Math.pow(n,o)),i=i.R(o).add(Fc(a))):i=(i=i.R(r)).add(Fc(a))}return i};var Yc=Ki.createWebChannelTransport=function(){return new Ac},Zc=Ki.getStatEventTarget=function(){return Co()},eu=Ki.ErrorCode=Po,tu=Ki.EventType=Lo,nu=Ki.Event=To,ru=Ki.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},iu=(Ki.FetchXmlHttpFactory=Ba,Ki.WebChannel=Uo),su=Ki.XhrIo=Wa,ou=Ki.Md5=Pc,au=Ki.Integer=Mc;const cu="@firebase/firestore";class uu{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}uu.UNAUTHENTICATED=new uu(null),uu.GOOGLE_CREDENTIALS=new uu("google-credentials-uid"),uu.FIRST_PARTY=new uu("first-party-uid"),uu.MOCK_USER=new uu("mock-user");let hu="10.8.1";const lu=new B("@firebase/firestore");function du(){return lu.logLevel}function fu(e,...t){if(lu.logLevel<=x.DEBUG){const n=t.map(mu);lu.debug(`Firestore (${hu}): ${e}`,...n)}}function pu(e,...t){if(lu.logLevel<=x.ERROR){const n=t.map(mu);lu.error(`Firestore (${hu}): ${e}`,...n)}}function gu(e,...t){if(lu.logLevel<=x.WARN){const n=t.map(mu);lu.warn(`Firestore (${hu}): ${e}`,...n)}}function mu(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function yu(e="Unexpected state"){const t=`FIRESTORE (${hu}) INTERNAL ASSERTION FAILED: `+e;throw pu(t),new Error(t)}function vu(e,t){e||yu()}function wu(e,t){return e}const _u={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Iu extends g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class bu{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Eu{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Tu{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(uu.UNAUTHENTICATED)))}shutdown(){}}class Su{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class Cu{constructor(e){this.t=e,this.currentUser=uu.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new bu;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new bu,e.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const t=i;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},o=e=>{fu("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(fu("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new bu)}}),0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(fu("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(vu("string"==typeof t.accessToken),new Eu(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return vu(null===e||"string"==typeof e),new uu(e)}}class ku{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=uu.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Au{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new ku(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable((()=>t(uu.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Nu{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Du{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const n=e=>{null!=e.error&&fu("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.R;return this.R=e.token,fu("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const r=e=>{fu("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.A.onInit((e=>r(e))),setTimeout((()=>{if(!this.appCheck){const e=this.A.getImmediate({optional:!0});e?r(e):fu("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(vu("string"==typeof e.token),this.R=e.token,new Nu(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Ru(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}class Ou{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=Ru(40);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function Pu(e,t){return e<t?-1:e>t?1:0}function Lu(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}class Mu{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Iu(_u.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Iu(_u.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Iu(_u.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Iu(_u.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Mu.fromMillis(Date.now())}static fromDate(e){return Mu.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new Mu(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Pu(this.nanoseconds,e.nanoseconds):Pu(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class xu{constructor(e){this.timestamp=e}static fromTimestamp(e){return new xu(e)}static min(){return new xu(new Mu(0,0))}static max(){return new xu(new Mu(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Uu{constructor(e,t,n){void 0===t?t=0:t>e.length&&yu(),void 0===n?n=e.length-t:n>e.length-t&&yu(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Uu.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Uu?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Fu extends Uu{construct(e,t,n){return new Fu(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new Iu(_u.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new Fu(t)}static emptyPath(){return new Fu([])}}const Vu=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ju extends Uu{construct(e,t,n){return new ju(e,t,n)}static isValidIdentifier(e){return Vu.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ju.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ju(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new Iu(_u.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new Iu(_u.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new Iu(_u.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new Iu(_u.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ju(t)}static emptyPath(){return new ju([])}}class Bu{constructor(e){this.path=e}static fromPath(e){return new Bu(Fu.fromString(e))}static fromName(e){return new Bu(Fu.fromString(e).popFirst(5))}static empty(){return new Bu(Fu.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Fu.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Fu.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Bu(new Fu(e.slice()))}}function $u(e){return new qu(e.readTime,e.key,-1)}class qu{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new qu(xu.min(),Bu.empty(),-1)}static max(){return new qu(xu.max(),Bu.empty(),-1)}}function zu(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=Bu.comparator(e.documentKey,t.documentKey),0!==n?n:Pu(e.largestBatchId,t.largestBatchId))}const Ku="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Hu{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Gu(e){if(e.code!==_u.FAILED_PRECONDITION||e.message!==Ku)throw e;fu("LocalStore","Unexpectedly lost primary lease")}class Wu{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&yu(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Wu(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof Wu?t:Wu.resolve(t)}catch(e){return Wu.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):Wu.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):Wu.reject(t)}static resolve(e){return new Wu(((t,n)=>{t(e)}))}static reject(e){return new Wu(((t,n)=>{n(e)}))}static waitFor(e){return new Wu(((t,n)=>{let r=0,i=0,s=!1;e.forEach((e=>{++r,e.next((()=>{++i,s&&i===r&&t()}),(e=>n(e)))})),s=!0,i===r&&t()}))}static or(e){let t=Wu.resolve(!1);for(const n of e)t=t.next((e=>e?Wu.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}static mapArray(e,t){return new Wu(((n,r)=>{const i=e.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;t(e[c]).next((e=>{s[c]=e,++o,o===i&&n(s)}),(e=>r(e)))}}))}static doWhile(e,t){return new Wu(((n,r)=>{const i=()=>{!0===e()?t().next((()=>{i()}),r):n()};i()}))}}class Qu{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new bu,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Yu(e,t.error)):this.V.resolve()},this.transaction.onerror=t=>{const n=rh(t.target.error);this.V.reject(new Yu(e,n))}}static open(e,t,n,r){try{return new Qu(t,e.transaction(r,n))}catch(e){throw new Yu(t,e)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(fu("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new eh(t)}}class Ju{constructor(e,t,n){this.name=e,this.version=t,this.p=n,12.2===Ju.S(l())&&pu("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return fu("SimpleDb","Removing database:",e),th(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!f())return!1;if(Ju.C())return!0;const e=l(),t=Ju.S(e),n=0<t&&t<10,r=Ju.v(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||i)}static C(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.F)}static M(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static v(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async O(e){return this.db||(fu("SimpleDb","Opening database:",this.name),this.db=await new Promise(((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{const n=e.target.result;t(n)},r.onblocked=()=>{n(new Yu(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{const r=t.target.error;"VersionError"===r.name?n(new Iu(_u.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new Iu(_u.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new Yu(e,r))},r.onupgradeneeded=e=>{fu("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);const t=e.target.result;this.p.N(t,r.transaction,e.oldVersion,this.version).next((()=>{fu("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.B&&(this.db.onversionchange=e=>this.B(e)),this.db}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){const i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.O(e);const t=Qu.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next((e=>(t.g(),e))).catch((e=>(t.abort(e),Wu.reject(e)))).toPromise();return s.catch((()=>{})),await t.m,s}catch(e){const t=e,n="FirebaseError"!==t.name&&s<3;if(fu("SimpleDb","Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class Xu{constructor(e){this.k=e,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(e){this.k=e}done(){this.q=!0}U(e){this.K=e}delete(){return th(this.k.delete())}}class Yu extends Iu{constructor(e,t){super(_u.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Zu(e){return"IndexedDbTransactionError"===e.name}class eh{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(fu("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(fu("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),th(n)}add(e){return fu("SimpleDb","ADD",this.store.name,e,e),th(this.store.add(e))}get(e){return th(this.store.get(e)).next((t=>(void 0===t&&(t=null),fu("SimpleDb","GET",this.store.name,e,t),t)))}delete(e){return fu("SimpleDb","DELETE",this.store.name,e),th(this.store.delete(e))}count(){return fu("SimpleDb","COUNT",this.store.name),th(this.store.count())}W(e,t){const n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){const e=r.getAll(n.range);return new Wu(((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}}))}{const e=this.cursor(n),t=[];return this.G(e,((e,n)=>{t.push(n)})).next((()=>t))}}j(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new Wu(((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}}))}H(e,t){fu("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.J=!1;const r=this.cursor(n);return this.G(r,((e,t,n)=>n.delete()))}Y(e,t){let n;t?n=e:(n={},t=e);const r=this.cursor(n);return this.G(r,t)}Z(e){const t=this.cursor({});return new Wu(((n,r)=>{t.onerror=e=>{const t=rh(e.target.error);r(t)},t.onsuccess=t=>{const r=t.target.result;r?e(r.primaryKey,r.value).next((e=>{e?r.continue():n()})):n()}}))}G(e,t){const n=[];return new Wu(((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{const i=e.target.result;if(!i)return void r();const s=new Xu(i),o=t(i.primaryKey,i.value,s);if(o instanceof Wu){const e=o.catch((e=>(s.done(),Wu.reject(e))));n.push(e)}s.isDone?r():null===s.$?i.continue():i.continue(s.$)}})).next((()=>Wu.waitFor(n)))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.J?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function th(e){return new Wu(((t,n)=>{e.onsuccess=e=>{const n=e.target.result;t(n)},e.onerror=e=>{const t=rh(e.target.error);n(t)}}))}let nh=!1;function rh(e){const t=Ju.S(l());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new Iu("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return nh||(nh=!0,setTimeout((()=>{throw e}),0)),e}}return e}class ih{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.se(e),this.oe=e=>t.writeSequenceNumber(e))}se(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.oe&&this.oe(e),e}}function sh(e){return null==e}function oh(e){return 0===e&&1/e==-1/0}ih._e=-1;function ah(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function ch(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function uh(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class hh{constructor(e,t){this.comparator=e,this.root=t||dh.EMPTY}insert(e,t){return new hh(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,dh.BLACK,null,null))}remove(e){return new hh(this.comparator,this.root.remove(e,this.comparator).copy(null,null,dh.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new lh(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new lh(this.root,e,this.comparator,!1)}getReverseIterator(){return new lh(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new lh(this.root,e,this.comparator,!0)}}class lh{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class dh{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:dh.RED,this.left=null!=r?r:dh.EMPTY,this.right=null!=i?i:dh.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new dh(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return dh.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return dh.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,dh.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,dh.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw yu();if(this.right.isRed())throw yu();const e=this.left.check();if(e!==this.right.check())throw yu();return e+(this.isRed()?0:1)}}dh.EMPTY=null,dh.RED=!0,dh.BLACK=!1,dh.EMPTY=new class{constructor(){this.size=0}get key(){throw yu()}get value(){throw yu()}get color(){throw yu()}get left(){throw yu()}get right(){throw yu()}copy(e,t,n,r,i){return this}insert(e,t,n){return new dh(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class fh{constructor(e){this.comparator=e,this.data=new hh(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ph(this.data.getIterator())}getIteratorFrom(e){return new ph(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof fh))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new fh(this.comparator);return t.data=e,t}}class ph{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class gh{constructor(e){this.fields=e,e.sort(ju.comparator)}static empty(){return new gh([])}unionWith(e){let t=new fh(ju.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new gh(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Lu(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class mh extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class yh{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new mh("Invalid base64 string: "+e):e}}(e);return new yh(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new yh(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Pu(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}yh.EMPTY_BYTE_STRING=new yh("");const vh=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function wh(e){if(vu(!!e),"string"==typeof e){let t=0;const n=vh.exec(e);if(vu(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:_h(e.seconds),nanos:_h(e.nanos)}}function _h(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Ih(e){return"string"==typeof e?yh.fromBase64String(e):yh.fromUint8Array(e)}function bh(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Eh(e){const t=e.mapValue.fields.__previous_value__;return bh(t)?Eh(t):t}function Th(e){const t=wh(e.mapValue.fields.__local_write_time__.timestampValue);return new Mu(t.seconds,t.nanos)}class Sh{constructor(e,t,n,r,i,s,o,a,c){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class Ch{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Ch("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Ch&&e.projectId===this.projectId&&e.database===this.database}}const kh={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Ah(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?bh(e)?4:$h(e)?9007199254740991:10:yu()}function Nh(e,t){if(e===t)return!0;const n=Ah(e);if(n!==Ah(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Th(e).isEqual(Th(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=wh(e.timestampValue),r=wh(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Ih(e.bytesValue).isEqual(Ih(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return _h(e.geoPointValue.latitude)===_h(t.geoPointValue.latitude)&&_h(e.geoPointValue.longitude)===_h(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return _h(e.integerValue)===_h(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=_h(e.doubleValue),r=_h(t.doubleValue);return n===r?oh(n)===oh(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return Lu(e.arrayValue.values||[],t.arrayValue.values||[],Nh);case 10:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(ah(n)!==ah(r))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!Nh(n[e],r[e])))return!1;return!0}(e,t);default:return yu()}}function Dh(e,t){return void 0!==(e.values||[]).find((e=>Nh(e,t)))}function Rh(e,t){if(e===t)return 0;const n=Ah(e),r=Ah(t);if(n!==r)return Pu(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Pu(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=_h(e.integerValue||e.doubleValue),r=_h(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Oh(e.timestampValue,t.timestampValue);case 4:return Oh(Th(e),Th(t));case 5:return Pu(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Ih(e),r=Ih(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=Pu(n[e],r[e]);if(0!==t)return t}return Pu(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=Pu(_h(e.latitude),_h(t.latitude));return 0!==n?n:Pu(_h(e.longitude),_h(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=Rh(n[e],r[e]);if(t)return t}return Pu(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===kh.mapValue&&t===kh.mapValue)return 0;if(e===kh.mapValue)return 1;if(t===kh.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){const t=Pu(r[e],s[e]);if(0!==t)return t;const o=Rh(n[r[e]],i[s[e]]);if(0!==o)return o}return Pu(r.length,s.length)}(e.mapValue,t.mapValue);default:throw yu()}}function Oh(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Pu(e,t);const n=wh(e),r=wh(t),i=Pu(n.seconds,r.seconds);return 0!==i?i:Pu(n.nanos,r.nanos)}function Ph(e){return Lh(e)}function Lh(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=wh(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return Ih(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return Bu.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=Lh(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${Lh(e.fields[i])}`;return n+"}"}(e.mapValue):yu()}function Mh(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function xh(e){return!!e&&"integerValue"in e}function Uh(e){return!!e&&"arrayValue"in e}function Fh(e){return!!e&&"nullValue"in e}function Vh(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function jh(e){return!!e&&"mapValue"in e}function Bh(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return ch(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=Bh(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Bh(e.arrayValue.values[n]);return t}return Object.assign({},e)}function $h(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}class qh{constructor(e){this.value=e}static empty(){return new qh({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!jh(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Bh(t)}setAll(e){let t=ju.emptyPath(),n={},r=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=Bh(e):r.push(i.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());jh(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Nh(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];jh(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){ch(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new qh(Bh(this.value))}}function zh(e){const t=[];return ch(e.fields,((e,n)=>{const r=new ju([e]);if(jh(n)){const e=zh(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)})),new gh(t)}class Kh{constructor(e,t,n,r,i,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new Kh(e,0,xu.min(),xu.min(),xu.min(),qh.empty(),0)}static newFoundDocument(e,t,n,r){return new Kh(e,1,t,xu.min(),n,r,0)}static newNoDocument(e,t){return new Kh(e,2,t,xu.min(),xu.min(),qh.empty(),0)}static newUnknownDocument(e,t){return new Kh(e,3,t,xu.min(),xu.min(),qh.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(xu.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=qh.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=qh.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=xu.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Kh&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Kh(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Hh{constructor(e,t){this.position=e,this.inclusive=t}}function Gh(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?Bu.comparator(Bu.fromName(o.referenceValue),n.key):Rh(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function Wh(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Nh(e.position[n],t.position[n]))return!1;return!0}class Qh{constructor(e,t="asc"){this.field=e,this.dir=t}}function Jh(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class Xh{}class Yh extends Xh{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new sl(e,t,n):"array-contains"===t?new ul(e,n):"in"===t?new hl(e,n):"not-in"===t?new ll(e,n):"array-contains-any"===t?new dl(e,n):new Yh(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new ol(e,n):new al(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Rh(t,this.value)):null!==t&&Ah(this.value)===Ah(t)&&this.matchesComparison(Rh(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return yu()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Zh extends Xh{constructor(e,t){super(),this.filters=e,this.op=t,this.ue=null}static create(e,t){return new Zh(e,t)}matches(e){return el(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.ue||(this.ue=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function el(e){return"and"===e.op}function tl(e){return function(e){for(const t of e.filters)if(t instanceof Zh)return!1;return!0}(e)&&el(e)}function nl(e){if(e instanceof Yh)return e.field.canonicalString()+e.op.toString()+Ph(e.value);if(tl(e))return e.filters.map((e=>nl(e))).join(",");{const t=e.filters.map((e=>nl(e))).join(",");return`${e.op}(${t})`}}function rl(e,t){return e instanceof Yh?function(e,t){return t instanceof Yh&&e.op===t.op&&e.field.isEqual(t.field)&&Nh(e.value,t.value)}(e,t):e instanceof Zh?function(e,t){return t instanceof Zh&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,r)=>e&&rl(n,t.filters[r])),!0)}(e,t):void yu()}function il(e){return e instanceof Yh?function(e){return`${e.field.canonicalString()} ${e.op} ${Ph(e.value)}`}(e):e instanceof Zh?function(e){return e.op.toString()+" {"+e.getFilters().map(il).join(" ,")+"}"}(e):"Filter"}class sl extends Yh{constructor(e,t,n){super(e,t,n),this.key=Bu.fromName(n.referenceValue)}matches(e){const t=Bu.comparator(e.key,this.key);return this.matchesComparison(t)}}class ol extends Yh{constructor(e,t){super(e,"in",t),this.keys=cl(0,t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class al extends Yh{constructor(e,t){super(e,"not-in",t),this.keys=cl(0,t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function cl(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>Bu.fromName(e.referenceValue)))}class ul extends Yh{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Uh(t)&&Dh(t.arrayValue,this.value)}}class hl extends Yh{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Dh(this.value.arrayValue,t)}}class ll extends Yh{constructor(e,t){super(e,"not-in",t)}matches(e){if(Dh(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Dh(this.value.arrayValue,t)}}class dl extends Yh{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Uh(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>Dh(this.value.arrayValue,e)))}}class fl{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.ce=null}}function pl(e,t=null,n=[],r=[],i=null,s=null,o=null){return new fl(e,t,n,r,i,s,o)}function gl(e){const t=wu(e);if(null===t.ce){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>nl(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),sh(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>Ph(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>Ph(e))).join(",")),t.ce=e}return t.ce}function ml(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!Jh(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!rl(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Wh(e.startAt,t.startAt)&&Wh(e.endAt,t.endAt)}function yl(e){return Bu.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class vl{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}}function wl(e){return new vl(e)}function _l(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Il(e){return null!==e.collectionGroup}function bl(e){const t=wu(e);if(null===t.le){t.le=[];const e=new Set;for(const n of t.explicitOrderBy)t.le.push(n),e.add(n.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",r=function(e){let t=new fh(ju.comparator);return e.filters.forEach((e=>{e.getFlattenedFilters().forEach((e=>{e.isInequality()&&(t=t.add(e.field))}))})),t}(t);r.forEach((r=>{e.has(r.canonicalString())||r.isKeyField()||t.le.push(new Qh(r,n))})),e.has(ju.keyField().canonicalString())||t.le.push(new Qh(ju.keyField(),n))}return t.le}function El(e){const t=wu(e);return t.he||(t.he=function(e,t){if("F"===e.limitType)return pl(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map((e=>{const t="desc"===e.dir?"asc":"desc";return new Qh(e.field,t)}));const n=e.endAt?new Hh(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new Hh(e.startAt.position,e.startAt.inclusive):null;return pl(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}(t,bl(e))),t.he}function Tl(e,t){const n=e.filters.concat([t]);return new vl(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Sl(e,t,n){return new vl(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Cl(e,t){return ml(El(e),El(t))&&e.limitType===t.limitType}function kl(e){return`${gl(El(e))}|lt:${e.limitType}`}function Al(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>il(e))).join(", ")}]`),sh(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>Ph(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>Ph(e))).join(",")),`Target(${t})`}(El(e))}; limitType=${e.limitType})`}function Nl(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Bu.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of bl(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=Gh(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,bl(e),t)||e.endAt&&!function(e,t,n){const r=Gh(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,bl(e),t))}(e,t)}function Dl(e){return(t,n)=>{let r=!1;for(const i of bl(e)){const e=Rl(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function Rl(e,t,n){const r=e.field.isKeyField()?Bu.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?Rh(r,i):yu()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return yu()}}class Ol{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){ch(this.inner,((t,n)=>{for(const[t,r]of n)e(t,r)}))}isEmpty(){return uh(this.inner)}size(){return this.innerSize}}const Pl=new hh(Bu.comparator);function Ll(){return Pl}const Ml=new hh(Bu.comparator);function xl(...e){let t=Ml;for(const n of e)t=t.insert(n.key,n);return t}function Ul(e){let t=Ml;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function Fl(){return jl()}function Vl(){return jl()}function jl(){return new Ol((e=>e.toString()),((e,t)=>e.isEqual(t)))}const Bl=new hh(Bu.comparator),$l=new fh(Bu.comparator);function ql(...e){let t=$l;for(const n of e)t=t.add(n);return t}const zl=new fh(Pu);function Kl(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:oh(t)?"-0":t}}function Hl(e){return{integerValue:""+e}}function Gl(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!oh(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}(t)?Hl(t):Kl(e,t)}class Wl{constructor(){this._=void 0}}function Ql(e,t,n){return e instanceof Yl?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&bh(t)&&(t=Eh(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Zl?ed(e,t):e instanceof td?nd(e,t):function(e,t){const n=Xl(e,t),r=id(n)+id(e.Ie);return xh(n)&&xh(e.Ie)?Hl(r):Kl(e.serializer,r)}(e,t)}function Jl(e,t,n){return e instanceof Zl?ed(e,t):e instanceof td?nd(e,t):n}function Xl(e,t){return e instanceof rd?function(e){return xh(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class Yl extends Wl{}class Zl extends Wl{constructor(e){super(),this.elements=e}}function ed(e,t){const n=sd(t);for(const t of e.elements)n.some((e=>Nh(e,t)))||n.push(t);return{arrayValue:{values:n}}}class td extends Wl{constructor(e){super(),this.elements=e}}function nd(e,t){let n=sd(t);for(const t of e.elements)n=n.filter((e=>!Nh(e,t)));return{arrayValue:{values:n}}}class rd extends Wl{constructor(e,t){super(),this.serializer=e,this.Ie=t}}function id(e){return _h(e.integerValue||e.doubleValue)}function sd(e){return Uh(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class od{constructor(e,t){this.field=e,this.transform=t}}class ad{constructor(e,t){this.version=e,this.transformResults=t}}class cd{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new cd}static exists(e){return new cd(void 0,e)}static updateTime(e){return new cd(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ud(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class hd{}function ld(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Id(e.key,cd.none()):new md(e.key,e.data,cd.none());{const n=e.data,r=qh.empty();let i=new fh(ju.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new yd(e.key,r,new gh(i.toArray()),cd.none())}}function dd(e,t,n){e instanceof md?function(e,t,n){const r=e.value.clone(),i=wd(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof yd?function(e,t,n){if(!ud(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=wd(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(vd(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function fd(e,t,n,r){return e instanceof md?function(e,t,n,r){if(!ud(e.precondition,t))return n;const i=e.value.clone(),s=_d(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof yd?function(e,t,n,r){if(!ud(e.precondition,t))return n;const i=_d(e.fieldTransforms,r,t),s=t.data;return s.setAll(vd(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,r):function(e,t,n){return ud(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function pd(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=Xl(r.transform,e||null);null!=i&&(null===n&&(n=qh.empty()),n.set(r.field,i))}return n||null}function gd(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&Lu(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Zl&&t instanceof Zl||e instanceof td&&t instanceof td?Lu(e.elements,t.elements,Nh):e instanceof rd&&t instanceof rd?Nh(e.Ie,t.Ie):e instanceof Yl&&t instanceof Yl}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class md extends hd{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class yd extends hd{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function vd(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function wd(e,t,n){const r=new Map;vu(e.length===n.length);for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,Jl(o,a,n[i]))}return r}function _d(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,Ql(e,s,t))}return r}class Id extends hd{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class bd extends hd{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Ed{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const r=this.mutations[t];r.key.isEqual(e.key)&&dd(r,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=fd(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=fd(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Vl();return this.mutations.forEach((r=>{const i=e.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=t.has(r.key)?null:o;const a=ld(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(xu.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),ql())}isEqual(e){return this.batchId===e.batchId&&Lu(this.mutations,e.mutations,((e,t)=>gd(e,t)))&&Lu(this.baseMutations,e.baseMutations,((e,t)=>gd(e,t)))}}class Td{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){vu(e.mutations.length===n.length);let r=Bl;const i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new Td(e,t,n,r)}}class Sd{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Cd{constructor(e,t){this.count=e,this.unchangedNames=t}}var kd,Ad;function Nd(e){if(void 0===e)return pu("GRPC error has no .code"),_u.UNKNOWN;switch(e){case kd.OK:return _u.OK;case kd.CANCELLED:return _u.CANCELLED;case kd.UNKNOWN:return _u.UNKNOWN;case kd.DEADLINE_EXCEEDED:return _u.DEADLINE_EXCEEDED;case kd.RESOURCE_EXHAUSTED:return _u.RESOURCE_EXHAUSTED;case kd.INTERNAL:return _u.INTERNAL;case kd.UNAVAILABLE:return _u.UNAVAILABLE;case kd.UNAUTHENTICATED:return _u.UNAUTHENTICATED;case kd.INVALID_ARGUMENT:return _u.INVALID_ARGUMENT;case kd.NOT_FOUND:return _u.NOT_FOUND;case kd.ALREADY_EXISTS:return _u.ALREADY_EXISTS;case kd.PERMISSION_DENIED:return _u.PERMISSION_DENIED;case kd.FAILED_PRECONDITION:return _u.FAILED_PRECONDITION;case kd.ABORTED:return _u.ABORTED;case kd.OUT_OF_RANGE:return _u.OUT_OF_RANGE;case kd.UNIMPLEMENTED:return _u.UNIMPLEMENTED;case kd.DATA_LOSS:return _u.DATA_LOSS;default:return yu()}}(Ad=kd||(kd={}))[Ad.OK=0]="OK",Ad[Ad.CANCELLED=1]="CANCELLED",Ad[Ad.UNKNOWN=2]="UNKNOWN",Ad[Ad.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ad[Ad.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ad[Ad.NOT_FOUND=5]="NOT_FOUND",Ad[Ad.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ad[Ad.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ad[Ad.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ad[Ad.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ad[Ad.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ad[Ad.ABORTED=10]="ABORTED",Ad[Ad.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ad[Ad.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ad[Ad.INTERNAL=13]="INTERNAL",Ad[Ad.UNAVAILABLE=14]="UNAVAILABLE",Ad[Ad.DATA_LOSS=15]="DATA_LOSS";const Dd=new au([4294967295,4294967295],0);function Rd(e){const t=(new TextEncoder).encode(e),n=new ou;return n.update(t),new Uint8Array(n.digest())}function Od(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new au([n,r],0),new au([i,s],0)]}class Pd{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Ld(`Invalid padding: ${t}`);if(n<0)throw new Ld(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new Ld(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new Ld(`Invalid padding when bitmap length is 0: ${t}`);this.Te=8*e.length-t,this.Ee=au.fromNumber(this.Te)}de(e,t,n){let r=e.add(t.multiply(au.fromNumber(n)));return 1===r.compare(Dd)&&(r=new au([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Ee).toNumber()}Ae(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Te)return!1;const t=Rd(e),[n,r]=Od(t);for(let e=0;e<this.hashCount;e++){const t=this.de(n,r,e);if(!this.Ae(t))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),s=new Pd(i,r,t);return n.forEach((e=>s.insert(e))),s}insert(e){if(0===this.Te)return;const t=Rd(e),[n,r]=Od(t);for(let e=0;e<this.hashCount;e++){const t=this.de(n,r,e);this.Re(t)}}Re(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class Ld extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Md{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,xd.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Md(xu.min(),r,new hh(Pu),Ll(),ql())}}class xd{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new xd(n,t,ql(),ql(),ql())}}class Ud{constructor(e,t,n,r){this.Ve=e,this.removedTargetIds=t,this.key=n,this.me=r}}class Fd{constructor(e,t){this.targetId=e,this.fe=t}}class Vd{constructor(e,t,n=yh.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class jd{constructor(){this.ge=0,this.pe=qd(),this.ye=yh.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return 0!==this.ge}get De(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.ye=e)}ve(){let e=ql(),t=ql(),n=ql();return this.pe.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:yu()}})),new xd(this.ye,this.we,e,t,n)}Fe(){this.Se=!1,this.pe=qd()}Me(e,t){this.Se=!0,this.pe=this.pe.insert(e,t)}xe(e){this.Se=!0,this.pe=this.pe.remove(e)}Oe(){this.ge+=1}Ne(){this.ge-=1,vu(this.ge>=0)}Be(){this.Se=!0,this.we=!0}}class Bd{constructor(e){this.Le=e,this.ke=new Map,this.qe=Ll(),this.Qe=$d(),this.Ke=new hh(Pu)}$e(e){for(const t of e.Ve)e.me&&e.me.isFoundDocument()?this.Ue(t,e.me):this.We(t,e.key,e.me);for(const t of e.removedTargetIds)this.We(t,e.key,e.me)}Ge(e){this.forEachTarget(e,(t=>{const n=this.ze(t);switch(e.state){case 0:this.je(t)&&n.Ce(e.resumeToken);break;case 1:n.Ne(),n.be||n.Fe(),n.Ce(e.resumeToken);break;case 2:n.Ne(),n.be||this.removeTarget(t);break;case 3:this.je(t)&&(n.Be(),n.Ce(e.resumeToken));break;case 4:this.je(t)&&(this.He(t),n.Ce(e.resumeToken));break;default:yu()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ke.forEach(((e,n)=>{this.je(n)&&t(n)}))}Je(e){const t=e.targetId,n=e.fe.count,r=this.Ye(t);if(r){const i=r.target;if(yl(i))if(0===n){const e=new Bu(i.path);this.We(t,e,Kh.newNoDocument(e,xu.min()))}else vu(1===n);else{const r=this.Ze(t);if(r!==n){const n=this.Xe(e),i=n?this.et(n,e,r):1;if(0!==i){this.He(t);const e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(t,e)}}}}}Xe(e){const t=e.fe.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=t;let s,o;try{s=Ih(n).toUint8Array()}catch(e){if(e instanceof mh)return gu("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{o=new Pd(s,r,i)}catch(e){return gu(e instanceof Ld?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===o.Te?null:o}et(e,t,n){return t.fe.count===n-this.rt(e,t.targetId)?0:2}rt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let r=0;return n.forEach((n=>{const i=this.Le.nt(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.We(t,n,null),r++)})),r}it(e){const t=new Map;this.ke.forEach(((n,r)=>{const i=this.Ye(r);if(i){if(n.current&&yl(i.target)){const t=new Bu(i.target.path);null!==this.qe.get(t)||this.st(r,t)||this.We(r,t,Kh.newNoDocument(t,e))}n.De&&(t.set(r,n.ve()),n.Fe())}}));let n=ql();this.Qe.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this.Ye(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))})),this.qe.forEach(((t,n)=>n.setReadTime(e)));const r=new Md(e,t,this.Ke,this.qe,n);return this.qe=Ll(),this.Qe=$d(),this.Ke=new hh(Pu),r}Ue(e,t){if(!this.je(e))return;const n=this.st(e,t.key)?2:0;this.ze(e).Me(t.key,n),this.qe=this.qe.insert(t.key,t),this.Qe=this.Qe.insert(t.key,this.ot(t.key).add(e))}We(e,t,n){if(!this.je(e))return;const r=this.ze(e);this.st(e,t)?r.Me(t,1):r.xe(t),this.Qe=this.Qe.insert(t,this.ot(t).delete(e)),n&&(this.qe=this.qe.insert(t,n))}removeTarget(e){this.ke.delete(e)}Ze(e){const t=this.ze(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Oe(e){this.ze(e).Oe()}ze(e){let t=this.ke.get(e);return t||(t=new jd,this.ke.set(e,t)),t}ot(e){let t=this.Qe.get(e);return t||(t=new fh(Pu),this.Qe=this.Qe.insert(e,t)),t}je(e){const t=null!==this.Ye(e);return t||fu("WatchChangeAggregator","Detected inactive target",e),t}Ye(e){const t=this.ke.get(e);return t&&t.be?null:this.Le._t(e)}He(e){this.ke.set(e,new jd),this.Le.getRemoteKeysForTarget(e).forEach((t=>{this.We(e,t,null)}))}st(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function $d(){return new hh(Bu.comparator)}function qd(){return new hh(Bu.comparator)}const zd={asc:"ASCENDING",desc:"DESCENDING"},Kd={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Hd={and:"AND",or:"OR"};class Gd{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Wd(e,t){return e.useProto3Json||sh(t)?t:{value:t}}function Qd(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Jd(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Xd(e,t){return Qd(e,t.toTimestamp())}function Yd(e){return vu(!!e),xu.fromTimestamp(function(e){const t=wh(e);return new Mu(t.seconds,t.nanos)}(e))}function Zd(e,t){return ef(e,t).canonicalString()}function ef(e,t){const n=function(e){return new Fu(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function tf(e){const t=Fu.fromString(e);return vu(_f(t)),t}function nf(e,t){return Zd(e.databaseId,t.path)}function rf(e,t){const n=tf(t);if(n.get(1)!==e.databaseId.projectId)throw new Iu(_u.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new Iu(_u.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new Bu(af(n))}function sf(e,t){return Zd(e.databaseId,t)}function of(e){return new Fu(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function af(e){return vu(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function cf(e,t,n){return{name:nf(e,t),fields:n.value.mapValue.fields}}function uf(e,t){return{documents:[sf(e,t.path)]}}function hf(e,t){const n={structuredQuery:{}},r=t.path;let i;null!==t.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=sf(e,i);const s=function(e){if(0!==e.length)return vf(Zh.create(e,"and"))}(t.filters);s&&(n.structuredQuery.where=s);const o=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:mf(e.field),direction:ff(e.dir)}}(e)))}(t.orderBy);o&&(n.structuredQuery.orderBy=o);const a=Wd(e,t.limit);return null!==a&&(n.structuredQuery.limit=a),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{ut:n,parent:i}}function lf(e){let t=function(e){const t=tf(e);return 4===t.length?Fu.emptyPath():af(t)}(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){vu(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function(e){const t=df(e);return t instanceof Zh&&tl(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=function(e){return e.map((e=>function(e){return new Qh(yf(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)))}(n.orderBy));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,sh(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new Hh(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new Hh(n,t)}(n.endAt)),function(e,t,n,r,i,s,o,a){return new vl(e,t,n,r,i,s,o,a)}(t,i,o,s,a,"F",c,u)}function df(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=yf(e.unaryFilter.field);return Yh.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=yf(e.unaryFilter.field);return Yh.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=yf(e.unaryFilter.field);return Yh.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=yf(e.unaryFilter.field);return Yh.create(i,"!=",{nullValue:"NULL_VALUE"});default:return yu()}}(e):void 0!==e.fieldFilter?function(e){return Yh.create(yf(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return yu()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return Zh.create(e.compositeFilter.filters.map((e=>df(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return yu()}}(e.compositeFilter.op))}(e):yu()}function ff(e){return zd[e]}function pf(e){return Kd[e]}function gf(e){return Hd[e]}function mf(e){return{fieldPath:e.canonicalString()}}function yf(e){return ju.fromServerFormat(e.fieldPath)}function vf(e){return e instanceof Yh?function(e){if("=="===e.op){if(Vh(e.value))return{unaryFilter:{field:mf(e.field),op:"IS_NAN"}};if(Fh(e.value))return{unaryFilter:{field:mf(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Vh(e.value))return{unaryFilter:{field:mf(e.field),op:"IS_NOT_NAN"}};if(Fh(e.value))return{unaryFilter:{field:mf(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:mf(e.field),op:pf(e.op),value:e.value}}}(e):e instanceof Zh?function(e){const t=e.getFilters().map((e=>vf(e)));return 1===t.length?t[0]:{compositeFilter:{op:gf(e.op),filters:t}}}(e):yu()}function wf(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function _f(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class If{constructor(e,t,n,r,i=xu.min(),s=xu.min(),o=yh.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new If(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new If(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new If(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new If(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class bf{constructor(e){this.ct=e}}function Ef(e){const t=lf({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Sl(t,t.limit,"L"):t}class Tf{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(_h(e.integerValue));else if("doubleValue"in e){const n=_h(e.doubleValue);isNaN(n)?this.Et(t,13):(this.Et(t,15),oh(n)?t.dt(0):t.dt(n))}else if("timestampValue"in e){const n=e.timestampValue;this.Et(t,20),"string"==typeof n?t.At(n):(t.At(`${n.seconds||""}`),t.dt(n.nanos||0))}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(Ih(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Et(t,45),t.dt(n.latitude||0),t.dt(n.longitude||0)}else"mapValue"in e?$h(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):yu()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){const n=e.fields||{};this.Et(t,55);for(const e of Object.keys(n))this.Rt(e,t),this.It(n[e],t)}wt(e,t){const n=e.values||[];this.Et(t,50);for(const e of n)this.It(e,t)}gt(e,t){this.Et(t,37),Bu.fromName(e).path.forEach((e=>{this.Et(t,60),this.St(e,t)}))}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}}Tf.bt=new Tf;class Sf{constructor(){this._n=new Cf}addToCollectionParentIndex(e,t){return this._n.add(t),Wu.resolve()}getCollectionParents(e,t){return Wu.resolve(this._n.getEntries(t))}addFieldIndex(e,t){return Wu.resolve()}deleteFieldIndex(e,t){return Wu.resolve()}deleteAllFieldIndexes(e){return Wu.resolve()}createTargetIndexes(e,t){return Wu.resolve()}getDocumentsMatchingTarget(e,t){return Wu.resolve(null)}getIndexType(e,t){return Wu.resolve(0)}getFieldIndexes(e,t){return Wu.resolve([])}getNextCollectionGroupToUpdate(e){return Wu.resolve(null)}getMinOffset(e,t){return Wu.resolve(qu.min())}getMinOffsetFromCollectionGroup(e,t){return Wu.resolve(qu.min())}updateCollectionGroup(e,t,n){return Wu.resolve()}updateIndexEntries(e,t){return Wu.resolve()}}class Cf{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new fh(Fu.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new fh(Fu.comparator)).toArray()}}new Uint8Array(0);class kf{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new kf(e,kf.DEFAULT_COLLECTION_PERCENTILE,kf.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}kf.DEFAULT_COLLECTION_PERCENTILE=10,kf.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,kf.DEFAULT=new kf(41943040,kf.DEFAULT_COLLECTION_PERCENTILE,kf.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),kf.DISABLED=new kf(-1,0,0);class Af{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new Af(0)}static Bn(){return new Af(-1)}}class Nf{constructor(){this.changes=new Ol((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Kh.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?Wu.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Df{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Rf{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&fd(n.mutation,e,gh.empty(),Mu.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,ql()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=ql()){const r=Fl();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((e=>{let t=xl();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=Fl();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,ql())))}populateOverlays(e,t,n){const r=[];return n.forEach((e=>{t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,r){let i=Ll();const s=jl(),o=jl();return t.forEach(((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof yd)?i=i.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),fd(o.mutation,t,o.mutation.getFieldMask(),Mu.now())):s.set(t.key,gh.empty())})),this.recalculateAndSaveOverlays(e,i).next((e=>(e.forEach(((e,t)=>s.set(e,t))),t.forEach(((e,t)=>{var n;return o.set(e,new Df(t,null!==(n=s.get(e))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(e,t){const n=jl();let r=new hh(((e,t)=>e-t)),i=ql();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const i of e)i.keys().forEach((e=>{const s=t.get(e);if(null===s)return;let o=n.get(e)||gh.empty();o=i.applyToLocalView(s,o),n.set(e,o);const a=(r.get(i.batchId)||ql()).add(e);r=r.insert(i.batchId,a)}))})).next((()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=Vl();c.forEach((e=>{if(!i.has(e)){const r=ld(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}})),s.push(this.documentOverlayCache.saveOverlays(e,a,u))}return Wu.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n,r){return function(e){return Bu.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Il(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):Wu.resolve(Fl());let o=-1,a=i;return s.next((t=>Wu.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?Wu.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{a=a.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,i))).next((()=>this.computeViews(e,a,t,ql()))).next((e=>({batchId:o,changes:Ul(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Bu(t)).next((e=>{let t=xl();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const i=t.collectionGroup;let s=xl();return this.indexManager.getCollectionParents(e,i).next((o=>Wu.forEach(o,(o=>{const a=function(e,t){return new vl(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(i));return this.getDocumentsMatchingCollectionQuery(e,a,n,r).next((e=>{e.forEach(((e,t)=>{s=s.insert(e,t)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r)))).next((e=>{i.forEach(((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,Kh.newInvalidDocument(r)))}));let n=xl();return e.forEach(((e,r)=>{const s=i.get(e);void 0!==s&&fd(s.mutation,r,gh.empty(),Mu.now()),Nl(t,r)&&(n=n.insert(e,r))})),n}))}}class Of{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,t){return Wu.resolve(this.cr.get(t))}saveBundleMetadata(e,t){return this.cr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:Yd(e.createTime)}}(t)),Wu.resolve()}getNamedQuery(e,t){return Wu.resolve(this.lr.get(t))}saveNamedQuery(e,t){return this.lr.set(t.name,function(e){return{name:e.name,query:Ef(e.bundledQuery),readTime:Yd(e.readTime)}}(t)),Wu.resolve()}}class Pf{constructor(){this.overlays=new hh(Bu.comparator),this.hr=new Map}getOverlay(e,t){return Wu.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Fl();return Wu.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.ht(e,t,r)})),Wu.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.hr.get(n);return void 0!==r&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.hr.delete(n)),Wu.resolve()}getOverlaysForCollection(e,t,n){const r=Fl(),i=t.length+1,s=new Bu(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return Wu.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new hh(((e,t)=>e-t));const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=Fl(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=Fl(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=r)););return Wu.resolve(o)}ht(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.hr.get(r.largestBatchId).delete(n.key);this.hr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Sd(t,n));let i=this.hr.get(t);void 0===i&&(i=ql(),this.hr.set(t,i)),this.hr.set(t,i.add(n.key))}}class Lf{constructor(){this.Pr=new fh(Mf.Ir),this.Tr=new fh(Mf.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,t){const n=new Mf(e,t);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}dr(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.Ar(new Mf(e,t))}Rr(e,t){e.forEach((e=>this.removeReference(e,t)))}Vr(e){const t=new Bu(new Fu([])),n=new Mf(t,e),r=new Mf(t,e+1),i=[];return this.Tr.forEachInRange([n,r],(e=>{this.Ar(e),i.push(e.key)})),i}mr(){this.Pr.forEach((e=>this.Ar(e)))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){const t=new Bu(new Fu([])),n=new Mf(t,e),r=new Mf(t,e+1);let i=ql();return this.Tr.forEachInRange([n,r],(e=>{i=i.add(e.key)})),i}containsKey(e){const t=new Mf(e,0),n=this.Pr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Mf{constructor(e,t){this.key=e,this.pr=t}static Ir(e,t){return Bu.comparator(e.key,t.key)||Pu(e.pr,t.pr)}static Er(e,t){return Pu(e.pr,t.pr)||Bu.comparator(e.key,t.key)}}class xf{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.yr=1,this.wr=new fh(Mf.Ir)}checkEmpty(e){return Wu.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Ed(i,t,n,r);this.mutationQueue.push(s);for(const t of r)this.wr=this.wr.add(new Mf(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return Wu.resolve(s)}lookupMutationBatch(e,t){return Wu.resolve(this.Sr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.br(n),i=r<0?0:r;return Wu.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return Wu.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(e){return Wu.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Mf(t,0),r=new Mf(t,Number.POSITIVE_INFINITY),i=[];return this.wr.forEachInRange([n,r],(e=>{const t=this.Sr(e.pr);i.push(t)})),Wu.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new fh(Pu);return t.forEach((e=>{const t=new Mf(e,0),r=new Mf(e,Number.POSITIVE_INFINITY);this.wr.forEachInRange([t,r],(e=>{n=n.add(e.pr)}))})),Wu.resolve(this.Dr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;Bu.isDocumentKey(i)||(i=i.child(""));const s=new Mf(new Bu(i),0);let o=new fh(Pu);return this.wr.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.pr)),!0)}),s),Wu.resolve(this.Dr(o))}Dr(e){const t=[];return e.forEach((e=>{const n=this.Sr(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){vu(0===this.Cr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.wr;return Wu.forEach(t.mutations,(r=>{const i=new Mf(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.wr=n}))}Mn(e){}containsKey(e,t){const n=new Mf(t,0),r=this.wr.firstAfterOrEqual(n);return Wu.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,Wu.resolve()}Cr(e,t){return this.br(e)}br(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Sr(e){const t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Uf{constructor(e){this.vr=e,this.docs=new hh(Bu.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.vr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Wu.resolve(n?n.document.mutableCopy():Kh.newInvalidDocument(t))}getEntries(e,t){let n=Ll();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Kh.newInvalidDocument(e))})),Wu.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=Ll();const s=t.path,o=new Bu(s.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||zu($u(o),n)<=0||(r.has(o.key)||Nl(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return Wu.resolve(i)}getAllFromCollectionGroup(e,t,n,r){yu()}Fr(e,t){return Wu.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new Ff(this)}getSize(e){return Wu.resolve(this.size)}}class Ff extends Nf{constructor(e){super(),this.ar=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.ar.addEntry(e,r)):this.ar.removeEntry(n)})),Wu.waitFor(t)}getFromCache(e,t){return this.ar.getEntry(e,t)}getAllFromCache(e,t){return this.ar.getEntries(e,t)}}class Vf{constructor(e){this.persistence=e,this.Mr=new Ol((e=>gl(e)),ml),this.lastRemoteSnapshotVersion=xu.min(),this.highestTargetId=0,this.Or=0,this.Nr=new Lf,this.targetCount=0,this.Br=Af.Nn()}forEachTarget(e,t){return this.Mr.forEach(((e,n)=>t(n))),Wu.resolve()}getLastRemoteSnapshotVersion(e){return Wu.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Wu.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Br.next(),Wu.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Or&&(this.Or=t),Wu.resolve()}qn(e){this.Mr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Br=new Af(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,t){return this.qn(t),this.targetCount+=1,Wu.resolve()}updateTargetData(e,t){return this.qn(t),Wu.resolve()}removeTargetData(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,Wu.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.Mr.forEach(((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.Mr.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)})),Wu.waitFor(i).next((()=>r))}getTargetCount(e){return Wu.resolve(this.targetCount)}getTargetData(e,t){const n=this.Mr.get(t)||null;return Wu.resolve(n)}addMatchingKeys(e,t,n){return this.Nr.dr(t,n),Wu.resolve()}removeMatchingKeys(e,t,n){this.Nr.Rr(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((t=>{i.push(r.markPotentiallyOrphaned(e,t))})),Wu.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Nr.Vr(t),Wu.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Nr.gr(t);return Wu.resolve(n)}containsKey(e,t){return Wu.resolve(this.Nr.containsKey(t))}}class jf{constructor(e,t){this.Lr={},this.overlays={},this.kr=new ih(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new Vf(this),this.indexManager=new Sf,this.remoteDocumentCache=function(e){return new Uf(e)}((e=>this.referenceDelegate.Kr(e))),this.serializer=new bf(t),this.$r=new Of(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Pf,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Lr[e.toKey()];return n||(n=new xf(t,this.referenceDelegate),this.Lr[e.toKey()]=n),n}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,t,n){fu("MemoryPersistence","Starting transaction:",e);const r=new Bf(this.kr.next());return this.referenceDelegate.Ur(),n(r).next((e=>this.referenceDelegate.Wr(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}Gr(e,t){return Wu.or(Object.values(this.Lr).map((n=>()=>n.containsKey(e,t))))}}class Bf extends Hu{constructor(e){super(),this.currentSequenceNumber=e}}class $f{constructor(e){this.persistence=e,this.zr=new Lf,this.jr=null}static Hr(e){return new $f(e)}get Jr(){if(this.jr)return this.jr;throw yu()}addReference(e,t,n){return this.zr.addReference(n,t),this.Jr.delete(n.toString()),Wu.resolve()}removeReference(e,t,n){return this.zr.removeReference(n,t),this.Jr.add(n.toString()),Wu.resolve()}markPotentiallyOrphaned(e,t){return this.Jr.add(t.toString()),Wu.resolve()}removeTarget(e,t){this.zr.Vr(t.targetId).forEach((e=>this.Jr.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.Jr.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Ur(){this.jr=new Set}Wr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Wu.forEach(this.Jr,(n=>{const r=Bu.fromPath(n);return this.Yr(e,r).next((e=>{e||t.removeEntry(r,xu.min())}))})).next((()=>(this.jr=null,t.apply(e))))}updateLimboDocument(e,t){return this.Yr(e,t).next((e=>{e?this.Jr.delete(t.toString()):this.Jr.add(t.toString())}))}Kr(e){return 0}Yr(e,t){return Wu.or([()=>Wu.resolve(this.zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gr(e,t)])}}class qf{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.qi=n,this.Qi=r}static Ki(e,t){let n=ql(),r=ql();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new qf(e,t.fromCache,n,r)}}class zf{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Kf{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=!function(){var e;const t=null===(e=o())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(e){return!1}}()&&navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")?8:Ju.v(l())>0?6:4}initialize(e,t){this.zi=e,this.indexManager=t,this.$i=!0}getDocumentsMatchingQuery(e,t,n,r){const i={result:null};return this.ji(e,t).next((e=>{i.result=e})).next((()=>{if(!i.result)return this.Hi(e,t,r,n).next((e=>{i.result=e}))})).next((()=>{if(i.result)return;const n=new zf;return this.Ji(e,t,n).next((r=>{if(i.result=r,this.Ui)return this.Yi(e,t,n,r.size)}))})).next((()=>i.result))}Yi(e,t,n,r){return n.documentReadCount<this.Wi?(du()<=x.DEBUG&&fu("QueryEngine","SDK will not create cache indexes for query:",Al(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),Wu.resolve()):(du()<=x.DEBUG&&fu("QueryEngine","Query:",Al(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Gi*r?(du()<=x.DEBUG&&fu("QueryEngine","The SDK decides to create cache indexes for query:",Al(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,El(t))):Wu.resolve())}ji(e,t){if(_l(t))return Wu.resolve(null);let n=El(t);return this.indexManager.getIndexType(e,n).next((r=>0===r?null:(null!==t.limit&&1===r&&(t=Sl(t,null,"F"),n=El(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((r=>{const i=ql(...r);return this.zi.getDocuments(e,i).next((r=>this.indexManager.getMinOffset(e,n).next((n=>{const s=this.Zi(t,r);return this.Xi(t,s,i,n.readTime)?this.ji(e,Sl(t,null,"F")):this.es(e,s,t,n)}))))})))))}Hi(e,t,n,r){return _l(t)||r.isEqual(xu.min())?Wu.resolve(null):this.zi.getDocuments(e,n).next((i=>{const s=this.Zi(t,i);return this.Xi(t,s,n,r)?Wu.resolve(null):(du()<=x.DEBUG&&fu("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Al(t)),this.es(e,s,t,function(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=xu.fromTimestamp(1e9===r?new Mu(n+1,0):new Mu(n,r));return new qu(i,Bu.empty(),t)}(r,-1)).next((e=>e)))}))}Zi(e,t){let n=new fh(Dl(e));return t.forEach(((t,r)=>{Nl(e,r)&&(n=n.add(r))})),n}Xi(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ji(e,t,n){return du()<=x.DEBUG&&fu("QueryEngine","Using full collection scan to execute query:",Al(t)),this.zi.getDocumentsMatchingQuery(e,t,qu.min(),n)}es(e,t,n,r){return this.zi.getDocumentsMatchingQuery(e,n,r).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}class Hf{constructor(e,t,n,r){this.persistence=e,this.ts=t,this.serializer=r,this.ns=new hh(Pu),this.rs=new Ol((e=>gl(e)),ml),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(n)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Rf(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.ns)))}}async function Gf(e,t){const n=wu(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next((i=>(r=i,n._s(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const i=[],s=[];let o=ql();for(const e of r){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({us:e,removedBatchIds:i,addedBatchIds:s})))}))}))}function Wf(e){const t=wu(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Qr.getLastRemoteSnapshotVersion(e)))}function Qf(e,t){const n=wu(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}async function Jf(e,t,n){const r=wu(e),i=r.ns.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(e){if(!Zu(e))throw e;fu("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.ns=r.ns.remove(t),r.rs.delete(i.target)}function Xf(e,t,n){const r=wu(e);let i=xu.min(),s=ql();return r.persistence.runTransaction("Execute query","readwrite",(e=>function(e,t,n){const r=wu(e),i=r.rs.get(n);return void 0!==i?Wu.resolve(r.ns.get(i)):r.Qr.getTargetData(t,n)}(r,e,El(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(e,t.targetId).next((e=>{s=e}))})).next((()=>r.ts.getDocumentsMatchingQuery(e,t,n?i:xu.min(),n?s:ql()))).next((e=>(function(e,t,n){let r=e.ss.get(t)||xu.min();n.forEach(((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.ss.set(t,r)}(r,function(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}(t),e),{documents:e,hs:s})))))}class Yf{constructor(){this.activeTargetIds=zl}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Zf{constructor(){this.no=new Yf,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,t,n){this.ro[e]=t}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new Yf,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class ep{io(e){}shutdown(){}}class tp{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){fu("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.uo)e(0)}ao(){fu("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.uo)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let np=null;function rp(){return null===np?np=268435456+Math.round(2147483648*Math.random()):np++,"0x"+np.toString(16)}const ip={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class sp{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}onMessage(e){this.Ao=e}close(){this.ho()}send(e){this.lo(e)}Ro(){this.Io()}Vo(e){this.Eo(e)}mo(e){this.Ao(e)}}const op="WebChannelConnection";class ap extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.fo=t+"://"+e.host,this.po=`projects/${n}/databases/${r}`,this.yo="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${r}`}get wo(){return!1}So(e,t,n,r,i){const s=rp(),o=this.bo(e,t.toUriEncodedString());fu("RestConnection",`Sending RPC '${e}' ${s}:`,o,n);const a={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(a,r,i),this.Co(e,o,a,n).then((t=>(fu("RestConnection",`Received RPC '${e}' ${s}: `,t),t)),(t=>{throw gu("RestConnection",`RPC '${e}' ${s} failed with error: `,t,"url: ",o,"request:",n),t}))}vo(e,t,n,r,i,s){return this.So(e,t,n,r,i)}Do(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+hu,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}bo(e,t){const n=ip[e];return`${this.fo}/v1/${t}:${n}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Co(e,t,n,r){const i=rp();return new Promise(((s,o)=>{const a=new su;a.setWithCredentials(!0),a.listenOnce(tu.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case eu.NO_ERROR:const t=a.getResponseJson();fu(op,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),s(t);break;case eu.TIMEOUT:fu(op,`RPC '${e}' ${i} timed out`),o(new Iu(_u.DEADLINE_EXCEEDED,"Request time out"));break;case eu.HTTP_ERROR:const n=a.getStatus();if(fu(op,`RPC '${e}' ${i} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(_u).indexOf(t)>=0?t:_u.UNKNOWN}(t.status);o(new Iu(e,t.message))}else o(new Iu(_u.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new Iu(_u.UNAVAILABLE,"Connection failed."));break;default:yu()}}finally{fu(op,`RPC '${e}' ${i} completed.`)}}));const c=JSON.stringify(r);fu(op,`RPC '${e}' ${i} sending request:`,r),a.send(t,"POST",c,n,15)}))}Fo(e,t,n){const r=rp(),i=[this.fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=Yc(),o=Zc(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Do(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const u=i.join("");fu(op,`Creating RPC '${e}' stream ${r}: ${u}`,a);const h=s.createWebChannel(u,a);let l=!1,d=!1;const f=new sp({lo:t=>{d?fu(op,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(l||(fu(op,`Opening RPC '${e}' stream ${r} transport.`),h.open(),l=!0),fu(op,`RPC '${e}' stream ${r} sending:`,t),h.send(t))},ho:()=>h.close()}),p=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return p(h,iu.EventType.OPEN,(()=>{d||fu(op,`RPC '${e}' stream ${r} transport opened.`)})),p(h,iu.EventType.CLOSE,(()=>{d||(d=!0,fu(op,`RPC '${e}' stream ${r} transport closed`),f.Vo())})),p(h,iu.EventType.ERROR,(t=>{d||(d=!0,gu(op,`RPC '${e}' stream ${r} transport errored:`,t),f.Vo(new Iu(_u.UNAVAILABLE,"The operation could not be completed")))})),p(h,iu.EventType.MESSAGE,(t=>{var n;if(!d){const i=t.data[0];vu(!!i);const s=i,o=s.error||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){fu(op,`RPC '${e}' stream ${r} received error:`,o);const t=o.status;let n=function(e){const t=kd[e];if(void 0!==t)return Nd(t)}(t),i=o.message;void 0===n&&(n=_u.INTERNAL,i="Unknown error status: "+t+" with message "+o.message),d=!0,f.Vo(new Iu(n,i)),h.close()}else fu(op,`RPC '${e}' stream ${r} received:`,i),f.mo(i)}})),p(o,nu.STAT_EVENT,(t=>{t.stat===ru.PROXY?fu(op,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===ru.NOPROXY&&fu(op,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{f.Ro()}),0),f}}function cp(){return"undefined"!=typeof document?document:null}function up(e){return new Gd(e,!0)}class hp{constructor(e,t,n=1e3,r=1.5,i=6e4){this.oi=e,this.timerId=t,this.Mo=n,this.xo=r,this.Oo=i,this.No=0,this.Bo=null,this.Lo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(e){this.cancel();const t=Math.floor(this.No+this.Qo()),n=Math.max(0,Date.now()-this.Lo),r=Math.max(0,t-n);r>0&&fu("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.No} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Bo=this.oi.enqueueAfterDelay(this.timerId,r,(()=>(this.Lo=Date.now(),e()))),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){null!==this.Bo&&(this.Bo.skipDelay(),this.Bo=null)}cancel(){null!==this.Bo&&(this.Bo.cancel(),this.Bo=null)}Qo(){return(Math.random()-.5)*this.No}}class lp{constructor(e,t,n,r,i,s,o,a){this.oi=e,this.$o=n,this.Uo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new hp(e,t)}Ho(){return 1===this.state||5===this.state||this.Jo()}Jo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Yo()}async stop(){this.Ho()&&await this.close(0)}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&null===this.Go&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,(()=>this.e_())))}t_(e){this.n_(),this.stream.send(e)}async e_(){if(this.Jo())return this.close(0)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}async close(e,t){this.n_(),this.r_(),this.jo.cancel(),this.Wo++,4!==e?this.jo.reset():t&&t.code===_u.RESOURCE_EXHAUSTED?(pu(t.toString()),pu("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):t&&t.code===_u.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.i_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.To(t)}i_(){}auth(){this.state=1;const e=this.s_(this.Wo),t=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.Wo===t&&this.o_(e,n)}),(t=>{e((()=>{const e=new Iu(_u.UNKNOWN,"Fetching auth token failed: "+t.message);return this.__(e)}))}))}o_(e,t){const n=this.s_(this.Wo);this.stream=this.a_(e,t),this.stream.Po((()=>{n((()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,(()=>(this.Jo()&&(this.state=3),Promise.resolve()))),this.listener.Po())))})),this.stream.To((e=>{n((()=>this.__(e)))})),this.stream.onMessage((e=>{n((()=>this.onMessage(e)))}))}Yo(){this.state=5,this.jo.qo((async()=>{this.state=0,this.start()}))}__(e){return fu("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}s_(e){return t=>{this.oi.enqueueAndForget((()=>this.Wo===e?t():(fu("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class dp extends lp{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}a_(e,t){return this.connection.Fo("Listen",e,t)}onMessage(e){this.jo.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:yu()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.useProto3Json?(vu(void 0===t||"string"==typeof t),yh.fromBase64String(t||"")):(vu(void 0===t||t instanceof Uint8Array),yh.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?_u.UNKNOWN:Nd(e.code);return new Iu(t,e.message||"")}(o);n=new Vd(r,i,s,a||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=rf(e,r.document.name),s=Yd(r.document.updateTime),o=r.document.createTime?Yd(r.document.createTime):xu.min(),a=new qh({mapValue:{fields:r.document.fields}}),c=Kh.newFoundDocument(i,s,o,a),u=r.targetIds||[],h=r.removedTargetIds||[];n=new Ud(u,h,c.key,c)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=rf(e,r.document),s=r.readTime?Yd(r.readTime):xu.min(),o=Kh.newNoDocument(i,s),a=r.removedTargetIds||[];n=new Ud([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=rf(e,r.document),s=r.removedTargetIds||[];n=new Ud([],s,i,null)}else{if(!("filter"in t))return yu();{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:i}=e,s=new Cd(r,i),o=e.targetId;n=new Fd(o,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return xu.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?xu.min():t.readTime?Yd(t.readTime):xu.min()}(e);return this.listener.u_(t,n)}c_(e){const t={};t.database=of(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=yl(r)?{documents:uf(e,r)}:{query:hf(e,r).ut},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=Jd(e,t.resumeToken);const r=Wd(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(xu.min())>0){n.readTime=Qd(e,t.snapshotVersion.toTimestamp());const r=Wd(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return yu()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.t_(t)}l_(e){const t={};t.database=of(this.serializer),t.removeTarget=e,this.t_(t)}}class fp extends lp{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(e,t){return this.connection.Fo("Write",e,t)}onMessage(e){if(vu(!!e.streamToken),this.lastStreamToken=e.streamToken,this.h_){this.jo.reset();const t=function(e,t){return e&&e.length>0?(vu(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?Yd(e.updateTime):Yd(t);return n.isEqual(xu.min())&&(n=Yd(t)),new ad(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=Yd(e.commitTime);return this.listener.T_(n,t)}return vu(!e.writeResults||0===e.writeResults.length),this.h_=!0,this.listener.E_()}d_(){const e={};e.database=of(this.serializer),this.t_(e)}I_(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>function(e,t){let n;if(t instanceof md)n={update:cf(e,t.key,t.value)};else if(t instanceof Id)n={delete:nf(e,t.key)};else if(t instanceof yd)n={update:cf(e,t.key,t.data),updateMask:wf(t.fieldMask)};else{if(!(t instanceof bd))return yu();n={verify:nf(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof Yl)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Zl)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof td)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof rd)return{fieldPath:t.field.canonicalString(),increment:n.Ie};throw yu()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Xd(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:yu()}(e,t.precondition)),n}(this.serializer,e)))};this.t_(t)}}class pp extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.A_=!1}R_(){if(this.A_)throw new Iu(_u.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,t,n,r){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection.So(e,ef(t,n),r,i,s))).catch((e=>{throw"FirebaseError"===e.name?(e.code===_u.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Iu(_u.UNKNOWN,e.toString())}))}vo(e,t,n,r,i){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,o])=>this.connection.vo(e,ef(t,n),r,s,o,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===_u.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Iu(_u.UNKNOWN,e.toString())}))}terminate(){this.A_=!0,this.connection.terminate()}}class gp{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){0===this.m_&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve()))))}S_(e){"Online"===this.state?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.y_("Offline")))}set(e){this.b_(),this.m_=0,"Online"===e&&(this.g_=!1),this.y_(e)}y_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}w_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(pu(t),this.g_=!1):fu("OnlineStateTracker",t)}b_(){null!==this.f_&&(this.f_.cancel(),this.f_=null)}}class mp{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=i,this.M_.io((e=>{n.enqueueAndForget((async()=>{Sp(this)&&(fu("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=wu(e);t.v_.add(4),await vp(t),t.x_.set("Unknown"),t.v_.delete(4),await yp(t)}(this))}))})),this.x_=new gp(n,r)}}async function yp(e){if(Sp(e))for(const t of e.F_)await t(!0)}async function vp(e){for(const t of e.F_)await t(!1)}function wp(e,t){const n=wu(e);n.C_.has(t.targetId)||(n.C_.set(t.targetId,t),Tp(n)?Ep(n):$p(n).Jo()&&Ip(n,t))}function _p(e,t){const n=wu(e),r=$p(n);n.C_.delete(t),r.Jo()&&bp(n,t),0===n.C_.size&&(r.Jo()?r.Xo():Sp(n)&&n.x_.set("Unknown"))}function Ip(e,t){if(e.O_.Oe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(xu.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}$p(e).c_(t)}function bp(e,t){e.O_.Oe(t),$p(e).l_(t)}function Ep(e){e.O_=new Bd({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),_t:t=>e.C_.get(t)||null,nt:()=>e.datastore.serializer.databaseId}),$p(e).start(),e.x_.p_()}function Tp(e){return Sp(e)&&!$p(e).Ho()&&e.C_.size>0}function Sp(e){return 0===wu(e).v_.size}function Cp(e){e.O_=void 0}async function kp(e){e.C_.forEach(((t,n)=>{Ip(e,t)}))}async function Ap(e,t){Cp(e),Tp(e)?(e.x_.S_(t),Ep(e)):e.x_.set("Unknown")}async function Np(e,t,n){if(e.x_.set("Online"),t instanceof Vd&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.C_.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.C_.delete(r),e.O_.removeTarget(r))}(e,t)}catch(n){fu("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await Dp(e,n)}else if(t instanceof Ud?e.O_.$e(t):t instanceof Fd?e.O_.Je(t):e.O_.Ge(t),!n.isEqual(xu.min()))try{const t=await Wf(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.O_.it(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.C_.get(r);i&&e.C_.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{const r=e.C_.get(t);if(!r)return;e.C_.set(t,r.withResumeToken(yh.EMPTY_BYTE_STRING,r.snapshotVersion)),bp(e,t);const i=new If(r.target,t,n,r.sequenceNumber);Ip(e,i)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){fu("RemoteStore","Failed to raise snapshot:",t),await Dp(e,t)}}async function Dp(e,t,n){if(!Zu(t))throw t;e.v_.add(1),await vp(e),e.x_.set("Offline"),n||(n=()=>Wf(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{fu("RemoteStore","Retrying IndexedDB access"),await n(),e.v_.delete(1),await yp(e)}))}function Rp(e,t){return t().catch((n=>Dp(e,n,t)))}async function Op(e){const t=wu(e),n=qp(t);let r=t.D_.length>0?t.D_[t.D_.length-1].batchId:-1;for(;Pp(t);)try{const e=await Qf(t.localStore,r);if(null===e){0===t.D_.length&&n.Xo();break}r=e.batchId,Lp(t,e)}catch(e){await Dp(t,e)}Mp(t)&&xp(t)}function Pp(e){return Sp(e)&&e.D_.length<10}function Lp(e,t){e.D_.push(t);const n=qp(e);n.Jo()&&n.P_&&n.I_(t.mutations)}function Mp(e){return Sp(e)&&!qp(e).Ho()&&e.D_.length>0}function xp(e){qp(e).start()}async function Up(e){qp(e).d_()}async function Fp(e){const t=qp(e);for(const n of e.D_)t.I_(n.mutations)}async function Vp(e,t,n){const r=e.D_.shift(),i=Td.from(r,t,n);await Rp(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),await Op(e)}async function jp(e,t){t&&qp(e).P_&&await async function(e,t){if(function(e){return function(e){switch(e){default:return yu();case _u.CANCELLED:case _u.UNKNOWN:case _u.DEADLINE_EXCEEDED:case _u.RESOURCE_EXHAUSTED:case _u.INTERNAL:case _u.UNAVAILABLE:case _u.UNAUTHENTICATED:return!1;case _u.INVALID_ARGUMENT:case _u.NOT_FOUND:case _u.ALREADY_EXISTS:case _u.PERMISSION_DENIED:case _u.FAILED_PRECONDITION:case _u.ABORTED:case _u.OUT_OF_RANGE:case _u.UNIMPLEMENTED:case _u.DATA_LOSS:return!0}}(e)&&e!==_u.ABORTED}(t.code)){const n=e.D_.shift();qp(e).Zo(),await Rp(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await Op(e)}}(e,t),Mp(e)&&xp(e)}async function Bp(e,t){const n=wu(e);n.asyncQueue.verifyOperationInProgress(),fu("RemoteStore","RemoteStore received new credentials");const r=Sp(n);n.v_.add(3),await vp(n),r&&n.x_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.v_.delete(3),await yp(n)}function $p(e){return e.N_||(e.N_=function(e,t,n){const r=wu(e);return r.R_(),new dp(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Po:kp.bind(null,e),To:Ap.bind(null,e),u_:Np.bind(null,e)}),e.F_.push((async t=>{t?(e.N_.Zo(),Tp(e)?Ep(e):e.x_.set("Unknown")):(await e.N_.stop(),Cp(e))}))),e.N_}function qp(e){return e.B_||(e.B_=function(e,t,n){const r=wu(e);return r.R_(),new fp(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Po:Up.bind(null,e),To:jp.bind(null,e),E_:Fp.bind(null,e),T_:Vp.bind(null,e)}),e.F_.push((async t=>{t?(e.B_.Zo(),await Op(e)):(await e.B_.stop(),e.D_.length>0&&(fu("RemoteStore",`Stopping write stream with ${e.D_.length} pending writes`),e.D_=[]))}))),e.B_}class zp{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new bu,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new zp(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Iu(_u.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Kp(e,t){if(pu("AsyncQueue",`${t}: ${e}`),Zu(e))return new Iu(_u.UNAVAILABLE,`${t}: ${e}`);throw e}class Hp{constructor(e){this.comparator=e?(t,n)=>e(t,n)||Bu.comparator(t.key,n.key):(e,t)=>Bu.comparator(e.key,t.key),this.keyedMap=xl(),this.sortedSet=new hh(this.comparator)}static emptySet(e){return new Hp(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Hp))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Hp;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Gp{constructor(){this.L_=new hh(Bu.comparator)}track(e){const t=e.doc.key,n=this.L_.get(t);n?0!==e.type&&3===n.type?this.L_=this.L_.insert(t,e):3===e.type&&1!==n.type?this.L_=this.L_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.L_=this.L_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.L_=this.L_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.L_=this.L_.remove(t):1===e.type&&2===n.type?this.L_=this.L_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.L_=this.L_.insert(t,{type:2,doc:e.doc}):yu():this.L_=this.L_.insert(t,e)}k_(){const e=[];return this.L_.inorderTraversal(((t,n)=>{e.push(n)})),e}}class Wp{constructor(e,t,n,r,i,s,o,a,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach((e=>{s.push({type:0,doc:e})})),new Wp(e,t,Hp.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Cl(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class Qp{constructor(){this.q_=void 0,this.Q_=[]}}class Jp{constructor(){this.queries=new Ol((e=>kl(e)),Cl),this.onlineState="Unknown",this.K_=new Set}}async function Xp(e,t){const n=wu(e),r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new Qp),i)try{s.q_=await n.onListen(r)}catch(e){const n=Kp(e,`Initialization of query '${Al(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.Q_.push(t),t.U_(n.onlineState),s.q_&&t.W_(s.q_)&&tg(n)}async function Yp(e,t){const n=wu(e),r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.Q_.indexOf(t);e>=0&&(s.Q_.splice(e,1),i=0===s.Q_.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function Zp(e,t){const n=wu(e);let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.Q_)t.W_(e)&&(r=!0);i.q_=e}}r&&tg(n)}function eg(e,t,n){const r=wu(e),i=r.queries.get(t);if(i)for(const e of i.Q_)e.onError(n);r.queries.delete(t)}function tg(e){e.K_.forEach((e=>{e.next()}))}class ng{constructor(e,t,n){this.query=e,this.G_=t,this.z_=!1,this.j_=null,this.onlineState="Unknown",this.options=n||{}}W_(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Wp(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.z_?this.H_(e)&&(this.G_.next(e),t=!0):this.J_(e,this.onlineState)&&(this.Y_(e),t=!0),this.j_=e,t}onError(e){this.G_.error(e)}U_(e){this.onlineState=e;let t=!1;return this.j_&&!this.z_&&this.J_(this.j_,e)&&(this.Y_(this.j_),t=!0),t}J_(e,t){if(!e.fromCache)return!0;const n="Offline"!==t;return(!this.options.Z_||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}H_(e){if(e.docChanges.length>0)return!0;const t=this.j_&&this.j_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Y_(e){e=Wp.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.z_=!0,this.G_.next(e)}}class rg{constructor(e){this.key=e}}class ig{constructor(e){this.key=e}}class sg{constructor(e,t){this.query=e,this.oa=t,this._a=null,this.hasCachedResults=!1,this.current=!1,this.aa=ql(),this.mutatedKeys=ql(),this.ua=Dl(e),this.ca=new Hp(this.ua)}get la(){return this.oa}ha(e,t){const n=t?t.Pa:new Gp,r=t?t.ca:this.ca;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const u=r.get(e),h=Nl(this.query,t)?t:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.Ia(u,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.ua(h,a)>0||c&&this.ua(h,c)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(h?(s=s.add(h),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{ca:s,Pa:n,Xi:o,mutatedKeys:i}}Ia(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){const i=this.ca;this.ca=e.ca,this.mutatedKeys=e.mutatedKeys;const s=e.Pa.k_();s.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return yu()}};return n(e)-n(t)}(e.type,t.type)||this.ua(e.doc,t.doc))),this.Ta(n),r=null!=r&&r;const o=t&&!r?this.Ea():[],a=0===this.aa.size&&this.current&&!r?1:0,c=a!==this._a;return this._a=a,0!==s.length||c?{snapshot:new Wp(this.query,e.ca,i,s,e.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),da:o}:{da:o}}U_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ca:this.ca,Pa:new Gp,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{da:[]}}Aa(e){return!this.oa.has(e)&&!!this.ca.has(e)&&!this.ca.get(e).hasLocalMutations}Ta(e){e&&(e.addedDocuments.forEach((e=>this.oa=this.oa.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.oa=this.oa.delete(e))),this.current=e.current)}Ea(){if(!this.current)return[];const e=this.aa;this.aa=ql(),this.ca.forEach((e=>{this.Aa(e.key)&&(this.aa=this.aa.add(e.key))}));const t=[];return e.forEach((e=>{this.aa.has(e)||t.push(new ig(e))})),this.aa.forEach((n=>{e.has(n)||t.push(new rg(n))})),t}Ra(e){this.oa=e.hs,this.aa=ql();const t=this.ha(e.documents);return this.applyChanges(t,!0)}Va(){return Wp.fromInitialDocuments(this.query,this.ca,this.mutatedKeys,0===this._a,this.hasCachedResults)}}class og{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class ag{constructor(e){this.key=e,this.ma=!1}}class cg{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.fa={},this.ga=new Ol((e=>kl(e)),Cl),this.pa=new Map,this.ya=new Set,this.wa=new hh(Bu.comparator),this.Sa=new Map,this.ba=new Lf,this.Da={},this.Ca=new Map,this.va=Af.Bn(),this.onlineState="Unknown",this.Fa=void 0}get isPrimaryClient(){return!0===this.Fa}}async function ug(e,t){const n=function(e){const t=wu(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=lg.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Sg.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=fg.bind(null,t),t.fa.u_=Zp.bind(null,t.eventManager),t.fa.xa=eg.bind(null,t.eventManager),t}(e);let r,i;const s=n.ga.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.Va();else{const e=await function(e,t){const n=wu(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.Qr.getTargetData(e,t).next((i=>i?(r=i,Wu.resolve(r)):n.Qr.allocateTargetId(e).next((i=>(r=new If(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.Qr.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.ns.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.ns=n.ns.insert(e.targetId,e),n.rs.set(t,e.targetId)),e}))}(n.localStore,El(t)),s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=await async function(e,t,n,r,i){e.Ma=(t,n,r)=>async function(e,t,n,r){let i=t.view.ha(n);i.Xi&&(i=await Xf(e.localStore,t.query,!1).then((({documents:e})=>t.view.ha(e,i))));const s=r&&r.targetChanges.get(t.targetId),o=r&&null!=r.targetMismatches.get(t.targetId),a=t.view.applyChanges(i,e.isPrimaryClient,s,o);return _g(e,t.targetId,a.da),a.snapshot}(e,t,n,r);const s=await Xf(e.localStore,t,!0),o=new sg(t,s.hs),a=o.ha(s.documents),c=xd.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=o.applyChanges(a,e.isPrimaryClient,c);_g(e,n,u.da);const h=new og(t,n,o);return e.ga.set(t,h),e.pa.has(n)?e.pa.get(n).push(t):e.pa.set(n,[t]),u.snapshot}(n,t,r,"current"===s,e.resumeToken),n.isPrimaryClient&&wp(n.remoteStore,e)}return i}async function hg(e,t){const n=wu(e),r=n.ga.get(t),i=n.pa.get(r.targetId);if(i.length>1)return n.pa.set(r.targetId,i.filter((e=>!Cl(e,t)))),void n.ga.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await Jf(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),_p(n.remoteStore,r.targetId),vg(n,r.targetId)})).catch(Gu)):(vg(n,r.targetId),await Jf(n.localStore,r.targetId,!0))}async function lg(e,t){const n=wu(e);try{const e=await function(e,t){const n=wu(e),r=t.snapshotVersion;let i=n.ns;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const s=n.os.newChangeBuffer({trackRemovals:!0});i=n.ns;const o=[];t.targetChanges.forEach(((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.Qr.removeMatchingKeys(e,s.removedDocuments,a).next((()=>n.Qr.addMatchingKeys(e,s.addedDocuments,a))));let u=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?u=u.withResumeToken(yh.EMPTY_BYTE_STRING,xu.min()).withLastLimboFreeSnapshotVersion(xu.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.Qr.updateTargetData(e,u))}));let a=Ll(),c=ql();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(function(e,t,n){let r=ql(),i=ql();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=Ll();return n.forEach(((n,s)=>{const o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(xu.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):fu("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{cs:r,ls:i}}))}(e,s,t.documentUpdates).next((e=>{a=e.cs,c=e.ls}))),!r.isEqual(xu.min())){const t=n.Qr.getLastRemoteSnapshotVersion(e).next((t=>n.Qr.setTargetsMetadata(e,e.currentSequenceNumber,r)));o.push(t)}return Wu.waitFor(o).next((()=>s.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,a,c))).next((()=>a))})).then((e=>(n.ns=i,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.Sa.get(t);r&&(vu(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.ma=!0:e.modifiedDocuments.size>0?vu(r.ma):e.removedDocuments.size>0&&(vu(r.ma),r.ma=!1))})),await Eg(n,e,t)}catch(e){await Gu(e)}}function dg(e,t,n){const r=wu(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.ga.forEach(((n,r)=>{const i=r.view.U_(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){const n=wu(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const e of n.Q_)e.U_(t)&&(r=!0)})),r&&tg(n)}(r.eventManager,t),e.length&&r.fa.u_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function fg(e,t,n){const r=wu(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Sa.get(t),s=i&&i.key;if(s){let e=new hh(Bu.comparator);e=e.insert(s,Kh.newNoDocument(s,xu.min()));const n=ql().add(s),i=new Md(xu.min(),new Map,new hh(Pu),e,n);await lg(r,i),r.wa=r.wa.remove(s),r.Sa.delete(t),bg(r)}else await Jf(r.localStore,t,!1).then((()=>vg(r,t,n))).catch(Gu)}async function pg(e,t){const n=wu(e),r=t.batch.batchId;try{const e=await function(e,t){const n=wu(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),i=n.os.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=Wu.resolve();return s.forEach((e=>{o=o.next((()=>r.getEntry(t,e))).next((t=>{const s=n.docVersions.get(e);vu(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),o.next((()=>e.mutationQueue.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=ql();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(n.localStore,t);yg(n,r,null),mg(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Eg(n,e)}catch(e){await Gu(e)}}async function gg(e,t,n){const r=wu(e);try{const e=await function(e,t){const n=wu(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(vu(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(r.localStore,t);yg(r,t,n),mg(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await Eg(r,e)}catch(n){await Gu(n)}}function mg(e,t){(e.Ca.get(t)||[]).forEach((e=>{e.resolve()})),e.Ca.delete(t)}function yg(e,t,n){const r=wu(e);let i=r.Da[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Da[r.currentUser.toKey()]=i}}function vg(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.pa.get(t))e.ga.delete(r),n&&e.fa.xa(r,n);e.pa.delete(t),e.isPrimaryClient&&e.ba.Vr(t).forEach((t=>{e.ba.containsKey(t)||wg(e,t)}))}function wg(e,t){e.ya.delete(t.path.canonicalString());const n=e.wa.get(t);null!==n&&(_p(e.remoteStore,n),e.wa=e.wa.remove(t),e.Sa.delete(n),bg(e))}function _g(e,t,n){for(const r of n)r instanceof rg?(e.ba.addReference(r.key,t),Ig(e,r)):r instanceof ig?(fu("SyncEngine","Document no longer in limbo: "+r.key),e.ba.removeReference(r.key,t),e.ba.containsKey(r.key)||wg(e,r.key)):yu()}function Ig(e,t){const n=t.key,r=n.path.canonicalString();e.wa.get(n)||e.ya.has(r)||(fu("SyncEngine","New document in limbo: "+n),e.ya.add(r),bg(e))}function bg(e){for(;e.ya.size>0&&e.wa.size<e.maxConcurrentLimboResolutions;){const t=e.ya.values().next().value;e.ya.delete(t);const n=new Bu(Fu.fromString(t)),r=e.va.next();e.Sa.set(r,new ag(n)),e.wa=e.wa.insert(n,r),wp(e.remoteStore,new If(El(wl(n.path)),r,"TargetPurposeLimboResolution",ih._e))}}async function Eg(e,t,n){const r=wu(e),i=[],s=[],o=[];r.ga.isEmpty()||(r.ga.forEach(((e,a)=>{o.push(r.Ma(a,t,n).then((e=>{if((e||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,(null==e?void 0:e.fromCache)?"not-current":"current"),e){i.push(e);const t=qf.Ki(a.targetId,e);s.push(t)}})))})),await Promise.all(o),r.fa.u_(i),await async function(e,t){const n=wu(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>Wu.forEach(t,(t=>Wu.forEach(t.qi,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>Wu.forEach(t.Qi,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!Zu(e))throw e;fu("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.ns.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.ns=n.ns.insert(t,i)}}}(r.localStore,s))}async function Tg(e,t){const n=wu(e);if(!n.currentUser.isEqual(t)){fu("SyncEngine","User change. New user:",t.toKey());const e=await Gf(n.localStore,t);n.currentUser=t,function(e,t){e.Ca.forEach((e=>{e.forEach((e=>{e.reject(new Iu(_u.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.Ca.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Eg(n,e.us)}}function Sg(e,t){const n=wu(e),r=n.Sa.get(t);if(r&&r.ma)return ql().add(r.key);{let e=ql();const r=n.pa.get(t);if(!r)return e;for(const t of r){const r=n.ga.get(t);e=e.unionWith(r.view.la)}return e}}function Cg(e){const t=wu(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=pg.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=gg.bind(null,t),t}class kg{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=up(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return function(e,t,n,r){return new Hf(e,t,n,r)}(this.persistence,new Kf,e.initialUser,this.serializer)}createPersistence(e){return new jf($f.Hr,this.serializer)}createSharedClientState(e){return new Zf}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Ag{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>dg(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=Tg.bind(null,this.syncEngine),await async function(e,t){const n=wu(e);t?(n.v_.delete(2),await yp(n)):t||(n.v_.add(2),await vp(n),n.x_.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Jp}createDatastore(e){const t=up(e.databaseInfo.databaseId),n=function(e){return new ap(e)}(e.databaseInfo);return function(e,t,n,r){return new pp(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,r,i){return new mp(e,t,n,r,i)}(this.localStore,this.datastore,e.asyncQueue,(e=>dg(this.syncEngine,e,0)),tp.D()?new tp:new ep)}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new cg(e,t,n,r,i,s);return o&&(a.Fa=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e;await async function(e){const t=wu(e);fu("RemoteStore","RemoteStore shutting down."),t.v_.add(5),await vp(t),t.M_.shutdown(),t.x_.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate()}}class Ng{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ba(this.observer.next,e)}error(e){this.observer.error?this.Ba(this.observer.error,e):pu("Uncaught Error in snapshot listener:",e.toString())}La(){this.muted=!0}Ba(e,t){this.muted||setTimeout((()=>{this.muted||e(t)}),0)}}class Dg{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=uu.UNAUTHENTICATED,this.clientId=Ou.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{fu("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(fu("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Iu(_u.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new bu;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Kp(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function Rg(e,t){e.asyncQueue.verifyOperationInProgress(),fu("FirestoreClient","Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await Gf(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function Og(e,t){e.asyncQueue.verifyOperationInProgress();const n=await async function(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){fu("FirestoreClient","Using user provided OfflineComponentProvider");try{await Rg(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!function(e){return"FirebaseError"===e.name?e.code===_u.FAILED_PRECONDITION||e.code===_u.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(n))throw n;gu("Error using user provided cache. Falling back to memory cache: "+n),await Rg(e,new kg)}}else fu("FirestoreClient","Using default OfflineComponentProvider"),await Rg(e,new kg);return e._offlineComponents}(e);fu("FirestoreClient","Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener((e=>Bp(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>Bp(t.remoteStore,n))),e._onlineComponents=t}async function Pg(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(fu("FirestoreClient","Using user provided OnlineComponentProvider"),await Og(e,e._uninitializedComponentsProvider._online)):(fu("FirestoreClient","Using default OnlineComponentProvider"),await Og(e,new Ag))),e._onlineComponents}async function Lg(e){const t=await Pg(e),n=t.eventManager;return n.onListen=ug.bind(null,t.syncEngine),n.onUnlisten=hg.bind(null,t.syncEngine),n}function Mg(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const xg=new Map;function Ug(e,t,n){if(!n)throw new Iu(_u.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Fg(e){if(!Bu.isDocumentKey(e))throw new Iu(_u.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Vg(e){if(Bu.isDocumentKey(e))throw new Iu(_u.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function jg(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":yu()}function Bg(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new Iu(_u.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=jg(e);throw new Iu(_u.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}class $g{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new Iu(_u.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Iu(_u.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new Iu(_u.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,e.experimentalForceLongPolling,0,e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Mg(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new Iu(_u.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new Iu(_u.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new Iu(_u.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class qg{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new $g({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Iu(_u.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new Iu(_u.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new $g(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Tu;switch(e.type){case"firstParty":return new Au(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new Iu(_u.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=xg.get(e);t&&(fu("ComponentProvider","Removing Datastore"),xg.delete(e),t.terminate())}(this),Promise.resolve()}}class zg{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new zg(this.firestore,e,this._query)}}class Kg{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Hg(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Kg(this.firestore,e,this._key)}}class Hg extends zg{constructor(e,t,n){super(e,t,wl(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Kg(this.firestore,null,new Bu(e))}withConverter(e){return new Hg(this.firestore,e,this._path)}}function Gg(e,t,...n){if(e=D(e),1===arguments.length&&(t=Ou.newId()),Ug("doc","path",t),e instanceof qg){const r=Fu.fromString(t,...n);return Fg(r),new Kg(e,null,new Bu(r))}{if(!(e instanceof Kg||e instanceof Hg))throw new Iu(_u.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(Fu.fromString(t,...n));return Fg(r),new Kg(e.firestore,e instanceof Hg?e.converter:null,new Bu(r))}}class Wg{constructor(){this.Xa=Promise.resolve(),this.eu=[],this.tu=!1,this.nu=[],this.ru=null,this.iu=!1,this.su=!1,this.ou=[],this.jo=new hp(this,"async_queue_retry"),this._u=()=>{const e=cp();e&&fu("AsyncQueue","Visibility state changed to "+e.visibilityState),this.jo.Ko()};const e=cp();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this._u)}get isShuttingDown(){return this.tu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.au(),this.uu(e)}enterRestrictedMode(e){if(!this.tu){this.tu=!0,this.su=e||!1;const t=cp();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._u)}}enqueue(e){if(this.au(),this.tu)return new Promise((()=>{}));const t=new bu;return this.uu((()=>this.tu&&this.su?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.eu.push(e),this.cu())))}async cu(){if(0!==this.eu.length){try{await this.eu[0](),this.eu.shift(),this.jo.reset()}catch(e){if(!Zu(e))throw e;fu("AsyncQueue","Operation failed with retryable error: "+e)}this.eu.length>0&&this.jo.qo((()=>this.cu()))}}uu(e){const t=this.Xa.then((()=>(this.iu=!0,e().catch((e=>{this.ru=e,this.iu=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw pu("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.iu=!1,e))))));return this.Xa=t,t}enqueueAfterDelay(e,t,n){this.au(),this.ou.indexOf(e)>-1&&(t=0);const r=zp.createAndSchedule(this,e,t,n,(e=>this.lu(e)));return this.nu.push(r),r}au(){this.ru&&yu()}verifyOperationInProgress(){}async hu(){let e;do{e=this.Xa,await e}while(e!==this.Xa)}Pu(e){for(const t of this.nu)if(t.timerId===e)return!0;return!1}Iu(e){return this.hu().then((()=>{this.nu.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.nu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.hu()}))}Tu(e){this.ou.push(e)}lu(e){const t=this.nu.indexOf(e);this.nu.splice(t,1)}}class Qg extends qg{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new Wg,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Xg(this),this._firestoreClient.terminate()}}function Jg(e){return e._firestoreClient||Xg(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function Xg(e){var t,n,r;const i=e._freezeSettings(),s=function(e,t,n,r){return new Sh(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,Mg(r.experimentalLongPollingOptions),r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._firestoreClient=new Dg(e._authCredentials,e._appCheckCredentials,e._queue,s),(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}class Yg{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Yg(yh.fromBase64String(e))}catch(e){throw new Iu(_u.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Yg(yh.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Zg{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new Iu(_u.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ju(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class em{constructor(e){this._methodName=e}}class tm{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Iu(_u.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Iu(_u.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Pu(this._lat,e._lat)||Pu(this._long,e._long)}}const nm=/^__.*__$/;class rm{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new yd(e,this.data,this.fieldMask,t,this.fieldTransforms):new md(e,this.data,t,this.fieldTransforms)}}class im{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new yd(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function sm(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw yu()}}class om{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Eu(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get du(){return this.settings.du}Au(e){return new om(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ru(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Au({path:n,Vu:!1});return r.mu(e),r}fu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Au({path:n,Vu:!1});return r.Eu(),r}gu(e){return this.Au({path:void 0,Vu:!0})}pu(e){return wm(e,this.settings.methodName,this.settings.yu||!1,this.path,this.settings.wu)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}Eu(){if(this.path)for(let e=0;e<this.path.length;e++)this.mu(this.path.get(e))}mu(e){if(0===e.length)throw this.pu("Document fields must not be empty");if(sm(this.du)&&nm.test(e))throw this.pu('Document fields cannot begin and end with "__"')}}class am{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||up(e)}Su(e,t,n,r=!1){return new om({du:e,methodName:t,wu:n,path:ju.emptyPath(),Vu:!1,yu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function cm(e){const t=e._freezeSettings(),n=up(e._databaseId);return new am(e._databaseId,!!t.ignoreUndefinedProperties,n)}function um(e,t,n,r,i,s={}){const o=e.Su(s.merge||s.mergeFields?2:0,t,n,i);gm("Data must be an object, but it was:",o,r);const a=fm(r,o);let c,u;if(s.merge)c=new gh(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=mm(t,r,n);if(!o.contains(i))throw new Iu(_u.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);_m(e,i)||e.push(i)}c=new gh(e),u=o.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,u=o.fieldTransforms;return new rm(new qh(a),c,u)}class hm extends em{_toFieldTransform(e){if(2!==e.du)throw 1===e.du?e.pu(`${this._methodName}() can only appear at the top level of your update data`):e.pu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof hm}}class lm extends em{constructor(e,t){super(e),this.bu=t}_toFieldTransform(e){const t=function(e,t,n){return new om({du:3,wu:t.settings.wu,methodName:e._methodName,Vu:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}(this,e,!0),n=this.bu.map((e=>dm(e,t))),r=new Zl(n);return new od(e.path,r)}isEqual(e){return e instanceof lm&&v(this.bu,e.bu)}}function dm(e,t){if(pm(e=D(e)))return gm("Unsupported field value:",t,e),fm(e,t);if(e instanceof em)return function(e,t){if(!sm(t.du))throw t.pu(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.pu(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Vu&&4!==t.du)throw t.pu("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=dm(i,t.gu(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=D(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Gl(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=Mu.fromDate(e);return{timestampValue:Qd(t.serializer,n)}}if(e instanceof Mu){const n=new Mu(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Qd(t.serializer,n)}}if(e instanceof tm)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Yg)return{bytesValue:Jd(t.serializer,e._byteString)};if(e instanceof Kg){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.pu(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Zd(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.pu(`Unsupported field value: ${jg(e)}`)}(e,t)}function fm(e,t){const n={};return uh(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):ch(e,((e,r)=>{const i=dm(r,t.Ru(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function pm(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Mu||e instanceof tm||e instanceof Yg||e instanceof Kg||e instanceof em)}function gm(e,t,n){if(!pm(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=jg(n);throw"an object"===r?t.pu(e+" a custom object"):t.pu(e+" "+r)}}function mm(e,t,n){if((t=D(t))instanceof Zg)return t._internalPath;if("string"==typeof t)return vm(e,t);throw wm("Field path arguments must be of type string or ",e,!1,void 0,n)}const ym=new RegExp("[~\\*/\\[\\]]");function vm(e,t,n){if(t.search(ym)>=0)throw wm(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new Zg(...t.split("."))._internalPath}catch(r){throw wm(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function wm(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new Iu(_u.INVALID_ARGUMENT,a+e+c)}function _m(e,t){return e.some((e=>e.isEqual(t)))}class Im{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Kg(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new bm(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Em("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class bm extends Im{data(){return super.data()}}function Em(e,t){return"string"==typeof t?vm(e,t):t instanceof Zg?t._internalPath:t._delegate._internalPath}class Tm{}class Sm extends Tm{}class Cm extends Sm{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Cm(e,t,n)}_apply(e){const t=this._parse(e);return Dm(e._query,t),new zg(e.firestore,e.converter,Tl(e._query,t))}_parse(e){const t=cm(e.firestore),n=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new Iu(_u.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){Nm(o,s);const t=[];for(const n of o)t.push(Am(r,e,n));a={arrayValue:{values:t}}}else a=Am(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||Nm(o,s),a=function(e,t,n,r=!1){return dm(n,e.Su(r?4:3,t))}(n,"where",o,"in"===s||"not-in"===s);return Yh.create(i,s,a)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value);return n}}class km extends Tm{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new km(e,t)}_parse(e){const t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return 1===t.length?t[0]:Zh.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const e of r)Dm(n,e),n=Tl(n,e)}(e._query,t),new zg(e.firestore,e.converter,Tl(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function Am(e,t,n){if("string"==typeof(n=D(n))){if(""===n)throw new Iu(_u.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Il(t)&&-1!==n.indexOf("/"))throw new Iu(_u.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(Fu.fromString(n));if(!Bu.isDocumentKey(r))throw new Iu(_u.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Mh(e,new Bu(r))}if(n instanceof Kg)return Mh(e,n._key);throw new Iu(_u.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${jg(n)}.`)}function Nm(e,t){if(!Array.isArray(e)||0===e.length)throw new Iu(_u.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Dm(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new Iu(_u.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new Iu(_u.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class Rm{convertValue(e,t="none"){switch(Ah(e)){case 0:return null;case 1:return e.booleanValue;case 2:return _h(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ih(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw yu()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return ch(e,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertGeoPoint(e){return new tm(_h(e.latitude),_h(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Eh(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Th(e));default:return null}}convertTimestamp(e){const t=wh(e);return new Mu(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=Fu.fromString(e);vu(_f(n));const r=new Ch(n.get(1),n.get(3)),i=new Bu(n.popFirst(5));return r.isEqual(t)||pu(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class Om{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Pm extends Im{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Lm(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(Em("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Lm extends Pm{data(e={}){return super.data(e)}}class Mm{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Om(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new Lm(this._firestore,this._userDataWriter,n.key,n,new Om(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Iu(_u.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const r=new Lm(e._firestore,e._userDataWriter,n.doc.key,n.doc,new Om(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const r=new Lm(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Om(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:xm(t.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function xm(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return yu()}}class Um extends Rm{constructor(e){super(),this.firestore=e}convertBytes(e){return new Yg(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Kg(this.firestore,null,t)}}function Fm(e,t){return function(e,t){const n=new bu;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const r=Cg(e);try{const e=await function(e,t){const n=wu(e),r=Mu.now(),i=t.reduce(((e,t)=>e.add(t.key)),ql());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let a=Ll(),c=ql();return n.os.getEntries(e,i).next((e=>{a=e,a.forEach(((e,t)=>{t.isValidDocument()||(c=c.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,a))).next((i=>{s=i;const o=[];for(const e of t){const t=pd(e,s.get(e.key).overlayedDocument);null!=t&&o.push(new yd(e.key,t,zh(t.value.mapValue),cd.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)})).next((t=>{o=t;const r=t.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:Ul(s)})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Da[e.currentUser.toKey()];r||(r=new hh(Pu)),r=r.insert(t,n),e.Da[e.currentUser.toKey()]=r}(r,e.batchId,n),await Eg(r,e.changes),await Op(r.remoteStore)}catch(e){const t=Kp(e,"Failed to persist write");n.reject(t)}}(await function(e){return Pg(e).then((e=>e.syncEngine))}(e),t,n))),n.promise}(Jg(e),t)}function Vm(...e){return new lm("arrayUnion",e)}new WeakMap,function(e,t=!0){!function(e){hu=e}(we),ge(new R("firestore",((e,{instanceIdentifier:n,options:r})=>{const i=e.getProvider("app").getImmediate(),s=new Qg(new Cu(e.getProvider("auth-internal")),new Du(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new Iu(_u.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ch(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),be(cu,"4.4.3",e),be(cu,"4.4.3","esm2017")}();var jm=_e({apiKey:"AIzaSyBpI0Dfq56oUexIsDu8Jn3yya5TyTcVL94",authDomain:"mucproject-070723.firebaseapp.com",projectId:"mucproject-070723",storageBucket:"mucproject-070723.appspot.com",messagingSenderId:"330836170033",appId:"1:330836170033:web:5dbc537644c8ea6ce04c10",measurementId:"G-NK595W90GJ"}),Bm=function(e=Ie()){const t=me(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=me(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(v(n.getOptions(),null!=t?t:{}))return e;nn(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:xi,persistence:[ti,Fr,jr]}),r=u("authTokenSyncURL");if(r){const e=(i=r,async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>ji)return;const r=null==t?void 0:t.token;Bi!==r&&(Bi=r,await fetch(i,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))});!function(e,t,n){D(e).beforeAuthStateChanged(t,n)}(n,e,(()=>e(n.currentUser))),function(t,n,r,i){D(t).onIdTokenChanged((t=>e(t)),void 0,void 0)}(n)}var i;const s=a("auth");return s&&function(e,t,n){const r=nr(e);on(r._canInitEmulator,r,"emulator-config-failed"),on(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!(null==n?void 0:n.disableWarnings),s=hr(t),{host:o,port:a}=function(e){const t=hr(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:lr(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:lr(t)}}}(t),c=null===a?"":`:${a}`;r.config.emulator={url:`${s}//${o}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,`http://${s}`),n}(jm),$m=(function(e=Ie()){const t=me(e=D(e),It);t.isInitialized()?t.getImmediate():function(e,t={}){const n=me(e,It);if(n.isInitialized()){const e=n.getImmediate();if(v(t,n.getOptions()))return e;throw At.create("already-initialized")}n.initialize({options:t})}(e)}(jm),function(e,t){const n="string"==typeof e?e:"(default)",r=me("object"==typeof e?e:Ie(),"firestore").getImmediate({identifier:n});if(!r._initialized){const e=(e=>{const t=a("firestore");if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]})();e&&function(e,t,n,r={}){var s;const o=(e=Bg(e,qg))._getSettings(),a=`${t}:${n}`;if("firestore.googleapis.com"!==o.host&&o.host!==a&&gu("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},o),{host:a,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=uu.MOCK_USER;else{t=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,s=e.sub||e.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},e);return[i(JSON.stringify({alg:"none",type:"JWT"})),i(JSON.stringify(o)),""].join(".")}(r.mockUserToken,null===(s=e._app)||void 0===s?void 0:s.options.projectId);const o=r.mockUserToken.sub||r.mockUserToken.user_id;if(!o)throw new Iu(_u.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new uu(o)}e._authCredentials=new Su(new Eu(t,n))}}(r,...e)}return r}(jm));function qm(e,t){(function(e,t,n,...r){e=Bg(e,Kg);const i=Bg(e.firestore,Qg),s=cm(i);let o;return o="string"==typeof(t=D(t))||t instanceof Zg?function(e,t,n,r,i,s){const o=e.Su(1,t,n),a=[mm(t,r,n)],c=[i];if(s.length%2!=0)throw new Iu(_u.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)a.push(mm(t,s[e])),c.push(s[e+1]);const u=[],h=qh.empty();for(let e=a.length-1;e>=0;--e)if(!_m(u,a[e])){const t=a[e];let n=c[e];n=D(n);const r=o.fu(t);if(n instanceof hm)u.push(t);else{const e=dm(n,r);null!=e&&(u.push(t),h.set(t,e))}}const l=new gh(u);return new im(h,l,o.fieldTransforms)}(s,"updateDoc",e._key,t,n,r):function(e,t,n,r){const i=e.Su(1,t,n);gm("Data must be an object, but it was:",i,r);const s=[],o=qh.empty();ch(r,((e,r)=>{const a=vm(t,e,n);r=D(r);const c=i.fu(a);if(r instanceof hm)s.push(a);else{const e=dm(r,c);null!=e&&(s.push(a),o.set(a,e))}}));const a=new gh(s);return new im(o,a,i.fieldTransforms)}(s,"updateDoc",e._key,t),Fm(i,[o.toMutation(e._key,cd.exists(!0))])})(Gg($m,"users",e),{friends:Vm(t)}).then((function(){console.log("Amigo aadido correctamente.")})).catch((function(e){console.error("Error al aadir amigo:",e)}))}function zm(e){return console.log("Buscando usuario:",e),function(e){e=Bg(e,zg);const t=Bg(e.firestore,Qg),n=Jg(t),r=new Um(t);return function(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new Iu(_u.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(e._query),function(e,t,n={}){const r=new bu;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new Ng({next:n=>{t.enqueueAndForget((()=>Yp(e,o))),n.fromCache&&"server"===r.source?i.reject(new Iu(_u.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new ng(n,s,{includeMetadataChanges:!0,Z_:!0});return Xp(e,o)}(await Lg(e),e.asyncQueue,t,n,r))),r.promise}(n,e._query).then((n=>new Mm(t,r,e,n)))}(function(e,t,...n){let r=[];t instanceof Tm&&r.push(t),r=r.concat(n),function(e){const t=e.filter((e=>e instanceof km)).length,n=e.filter((e=>e instanceof Cm)).length;if(t>1||t>0&&n>0)throw new Iu(_u.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const t of r)e=t._apply(e);return e}(function(e,t,...n){if(e=D(e),Ug("collection","path",t),e instanceof qg){const r=Fu.fromString(t,...n);return Vg(r),new Hg(e,null,r)}{if(!(e instanceof Kg||e instanceof Hg))throw new Iu(_u.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(Fu.fromString(t,...n));return Vg(r),new Hg(e.firestore,null,r)}}($m,"users"),function(e,t,n){const r=Em("where","username");return Cm._create(r,"==",n)}(0,0,e))).then((function(e){return e.empty?(console.log("Usuario no encontrado."),null):e.docs[0].data().username})).catch((function(e){return console.error("Error al buscar usuario:",e),null}))}function Km(){var e=window.location.hash.substring(1)||"chats",t="./".concat(e,".html");fetch(t).then((function(e){return e.text()})).then((function(t){var n;document.getElementById("content").innerHTML=t,"chats"===e&&(n=document.getElementById("addFriendButton"))&&n.addEventListener("click",(function(){var e=document.getElementById("addFriend").value;e?zm(e).then((function(e){e?qm(Bm.currentUser.uid,e):console.log("Usuario no encontrado.")})):console.log("Por favor, introduce un nombre de usuario.")}))})).catch((function(e){return console.error("Error al cargar la vista",e)}))}document.querySelector(".register form")&&document.querySelector(".register form").addEventListener("submit",(function(e){e.preventDefault();var t=document.getElementById("newMail").value,n=document.getElementById("newPassword").value,r=document.getElementById("confirmP").value,i=document.getElementById("newUsername").value;n===r?async function(e,t,n){const r=nr(e),i=ur(r,{returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Ar),s=await i.catch((t=>{throw"auth/password-does-not-meet-requirements"===t.code&&Lr(e),t})),o=await Nr._fromIdTokenResponse(r,"signIn",s);return await r._updateCurrentUser(o.user),o}(Bm,t,n).then((function(e){console.log("Usuario registrado exitosamente:",e.user),console.log(i),function(t,n){(async function(e,{displayName:t,photoURL:n}){if(void 0===t&&void 0===n)return;const r=D(e),i={idToken:await r.getIdToken(),displayName:t,photoUrl:n,returnSecureToken:!0},s=await Nn(r,async function(e,t){return yn(e,"POST","/v1/accounts:update",t)}(r.auth,i));r.displayName=s.displayName||null,r.photoURL=s.photoUrl||null;const o=r.providerData.find((({providerId:e})=>"password"===e));o&&(o.displayName=r.displayName,o.photoURL=r.photoURL),await r._updateTokensIfNecessary(s)})(e.user,{displayName:n}).then((function(){console.log("Perfil actualizado",e.user.displayName)})).catch((function(e){console.error("Error al actualizar el perfil del usuario:",e)}))}(e.user,i),console.log("hola"),function(e,t,n){e=Bg(e,Kg);const r=Bg(e.firestore,Qg),i=function(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}(e.converter,t,n);return Fm(r,[um(cm(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,cd.none())])}(Gg($m,"users",e.user.uid),{username:i,friends:[]}).then((function(){console.log("Documento del usuario creado con xito en Firestore"),function(e){e=Bg(e,Kg);const t=Bg(e.firestore,Qg);return function(e,t,n={}){const r=new bu;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new Ng({next:s=>{t.enqueueAndForget((()=>Yp(e,o)));const a=s.docs.has(n);!a&&s.fromCache?i.reject(new Iu(_u.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&r&&"server"===r.source?i.reject(new Iu(_u.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:e=>i.reject(e)}),o=new ng(wl(n.path),s,{includeMetadataChanges:!0,Z_:!0});return Xp(e,o)}(await Lg(e),e.asyncQueue,t,n,r))),r.promise}(Jg(t),e._key).then((n=>function(e,t,n){const r=n.docs.get(t._key),i=new Um(e);return new Pm(e,i,t._key,r,new Om(n.hasPendingWrites,n.fromCache),t.converter)}(t,e,n)))}(Gg($m,"users",e.user.uid)).then((function(e){e.exists()?console.error("Documento del usuario recuperado de Firestore:",e.data()):console.log("No se encontr el documento del usuario despus de crearlo.")}))})).catch((function(e){console.error("Error al crear el documento del usuario en Firestore:",e)}))})).catch((function(e){console.error("Error al registrar el usuario:",e)})):alert("Contraseas no iguales")})),document.querySelector(".login form")&&document.querySelector(".login form").addEventListener("submit",(function(e){e.preventDefault();var t=document.getElementById("mail").value,n=document.getElementById("password").value;(function(e,t,n){return async function(e,t){return Pr(nr(e),t)}(D(e),Ir.credential(t,n)).catch((async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&Lr(e),t}))})(Bm,t,n).then((function(e){console.log("Usuario conectado exitosamente:",e.user),window.location.href="main.html"})).catch((function(e){console.error("Revisa tus datos",e),alert("Las credenciales son incorrectas o el usuario no existe.")}))})),window.dispatchEvent(new Event("firebase-loaded")),document.addEventListener("DOMContentLoaded",(function(){Km()})),window.addEventListener("hashchange",Km),window.addEventListener("load",Km),window.onload=function(){window.dispatchEvent(new Event("firebase-loaded"))}})()})();